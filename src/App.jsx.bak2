import { useState, useEffect, useRef } from "react";
import { TN, F, F2 } from "./constants/theme";
import { SLIDES } from "./constants/slides";
import { CATS, ML } from "./constants/categories";
import { REGIONS, PROFILES, COMPS, SEASONS, ZONES } from "./constants/data";
import { PL } from "./constants/places";
import Logo from "./components/Logo";
import Carousel from "./components/Carousel";

var CATS={attraction:{i:"üèõÔ∏è",l:"Attractions"},restaurant:{i:"üçΩÔ∏è",l:"Restaurants"},cafe:{i:"‚òï",l:"Caf√©s"},hotel:{i:"üè®",l:"H√¥tels"},beach:{i:"üèñÔ∏è",l:"Plages"},activity:{i:"üéØ",l:"Activit√©s"},nature:{i:"üåø",l:"Nature"},mosque:{i:"üïå",l:"Mosqu√©es"}};

var REGIONS=[
  {id:"tunis",name:"Grand Tunis",icon:"üèõÔ∏è",lt:36.81,lg:10.18,subs:["Tunis Centre","Carthage & Sidi Bou Sa√Ød","La Marsa & Gammarth"]},
  {id:"sahel",name:"Sahel",icon:"üèüÔ∏è",lt:35.75,lg:10.70,subs:["Sousse","Monastir","Mahdia"]},
  {id:"nord_ouest",name:"Nord-Ouest",icon:"üå≤",lt:36.60,lg:8.90,subs:["Tabarka","A√Øn Draham","B√©ja","Le Kef","Testour & Dougga","Bou Salem"]},
  {id:"nord_est",name:"Nord-Est",icon:"‚öì",lt:37.27,lg:9.87,subs:["Bizerte","Ichkeul","Raf Raf","Ghar El Melh"]},
  {id:"zaghouan",name:"Zaghouan",icon:"‚õ∞Ô∏è",lt:36.40,lg:10.14,subs:["Zaghouan","Jbel Oust"]},
  {id:"cap_bon",name:"Cap Bon",icon:"üåä",lt:36.60,lg:10.80,subs:["Hammamet","Nabeul","K√©libia","Korbus","El Haouaria","Korba","Soliman"]},
  {id:"centre",name:"Centre",icon:"üïå",lt:35.50,lg:10.30,subs:["Kairouan","El Jem"]},
  {id:"sud_ouest",name:"Sud-Ouest",icon:"üå¥",lt:33.92,lg:8.13,subs:["Tozeur","Nefta & Chebika","Tamerza","Douz"]},
  {id:"sud_est",name:"Sud-Est",icon:"üèúÔ∏è",lt:33.50,lg:10.20,subs:["Matmata","Tataouine","Gab√®s","M√©denine & Zarzis"]},
  {id:"djerba",name:"Djerba",icon:"üèùÔ∏è",lt:33.81,lg:10.86,subs:["Houmt Souk","Midoun","Erriadh"]},
  {id:"sfax",name:"Sfax",icon:"üêö",lt:34.74,lg:10.76,subs:["Sfax Ville","Kerkennah"]}
];

var PL=[
  {id:"bardo",n:"Mus√©e du Bardo",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.81,lg:10.14,rt:4.7,dur:120,cost:13,hid:false,sn:["printemps","ete","automne","hiver"],cr:.6,d:"Plus grande collection mosa√Øques romaines au monde.",meal:null},
  {id:"medina_t",n:"M√©dina de Tunis",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.80,lg:10.17,rt:4.5,dur:100,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.88,d:"UNESCO. 700+ monuments, mosqu√©e Zitouna.",meal:null},
  {id:"marche",n:"March√© Central",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.80,lg:10.18,rt:4.2,dur:50,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.78,d:"Poissons, √©pices, olives, harissa artisanale.",meal:null},
  {id:"fondouk",n:"Fondouk El Attarine",r:"tunis",sub:"Tunis Centre",cat:"cafe",lt:36.80,lg:10.17,rt:4.4,dur:40,cost:12,hid:true,sn:["printemps","ete","automne","hiver"],cr:.35,d:"Th√© √† la menthe dans fondouk du XVIIe.",meal:"breakfast"},
  {id:"cafe_mr",n:"Caf√© M'Rabet",r:"tunis",sub:"Tunis Centre",cat:"cafe",lt:36.80,lg:10.17,rt:4.3,dur:35,cost:8,hid:true,sn:["printemps","ete","automne","hiver"],cr:.40,d:"Plus vieux caf√© de Tunis, ftour traditionnel.",meal:"breakfast"},
  {id:"dar_med",n:"Dar El Medina",r:"tunis",sub:"Tunis Centre",cat:"restaurant",lt:36.80,lg:10.17,rt:4.6,dur:75,cost:45,hid:true,sn:["printemps","ete","automne","hiver"],cr:.25,d:"Gastronomie raffin√©e dans palais XVIIIe.",meal:"dinner"},
  {id:"belhadj",n:"Dar Bel Hadj",r:"tunis",sub:"Tunis Centre",cat:"restaurant",lt:36.80,lg:10.17,rt:4.5,dur:70,cost:35,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Couscous au m√©rou, cadre somptueux.",meal:"lunch"},
  {id:"belved",n:"Parc du Belv√©d√®re",r:"tunis",sub:"Tunis Centre",cat:"nature",lt:36.82,lg:10.16,rt:4.0,dur:50,cost:0,hid:true,sn:["printemps","ete","automne"],cr:.35,d:"110 ha de verdure, zoo, koubba.",meal:null},
  {id:"carthage",n:"Site de Carthage",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"attraction",lt:36.85,lg:10.32,rt:4.6,dur:100,cost:12,hid:false,sn:["printemps","automne","hiver"],cr:.82,d:"UNESCO. Thermes d'Antonin, Byrsa.",meal:null},
  {id:"sbs",n:"Sidi Bou Sa√Ød",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"attraction",lt:36.87,lg:10.35,rt:4.8,dur:80,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.85,d:"Village bleu et blanc mythique.",meal:null},
  {id:"nattes",n:"Caf√© des Nattes",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"cafe",lt:36.87,lg:10.35,rt:4.5,dur:40,cost:8,hid:false,sn:["printemps","ete","automne"],cr:.80,d:"Caf√© historique 1700. Th√© aux pignons.",meal:"breakfast"},
  {id:"zarrouk",n:"Dar Zarrouk",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"restaurant",lt:36.87,lg:10.35,rt:4.7,dur:80,cost:65,hid:false,sn:["printemps","ete","automne"],cr:.40,d:"Table gastronomique vue panoramique mer.",meal:"dinner"},
  {id:"bonvieux",n:"Au Bon Vieux Temps",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"restaurant",lt:36.87,lg:10.35,rt:4.4,dur:70,cost:40,hid:false,sn:["printemps","ete","automne"],cr:.55,d:"Terrasse vue mer, m√©diterran√©enne.",meal:"lunch"},
  {id:"marsa_pl",n:"Plage La Marsa",r:"tunis",sub:"La Marsa & Gammarth",cat:"beach",lt:36.88,lg:10.33,rt:4.3,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.65,d:"Banlieue baln√©aire chic, galeries.",meal:null},
  {id:"boga",n:"Boga Beach Club",r:"tunis",sub:"La Marsa & Gammarth",cat:"beach",lt:36.89,lg:10.31,rt:4.2,dur:120,cost:30,hid:false,sn:["ete"],cr:.70,d:"Beach club, DJ sets, piscine.",meal:null},
  {id:"s_med",n:"M√©dina Sousse",r:"sahel",sub:"Sousse",cat:"attraction",lt:35.83,lg:10.64,rt:4.4,dur:80,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.65,d:"UNESCO. Ribat VIIIe, Grande Mosqu√©e.",meal:null},
  {id:"kantaoui",n:"Port El Kantaoui",r:"sahel",sub:"Sousse",cat:"beach",lt:35.89,lg:10.59,rt:4.1,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.70,d:"Marina luxe, golf, parc aquatique.",meal:null},
  {id:"golfe_r",n:"Le Golfe",r:"sahel",sub:"Sousse",cat:"restaurant",lt:35.83,lg:10.64,rt:4.3,dur:70,cost:30,hid:false,sn:["printemps","ete","automne","hiver"],cr:.50,d:"Fruits de mer face au vieux port.",meal:"lunch"},
  {id:"cafe_s",n:"Caf√© de la Place",r:"sahel",sub:"Sousse",cat:"cafe",lt:35.83,lg:10.64,rt:4.1,dur:35,cost:8,hid:false,sn:["printemps","ete","automne","hiver"],cr:.60,d:"Petit-d√©jeuner tunisien face m√©dina.",meal:"breakfast"},
  {id:"takr",n:"Village Takrouna",r:"sahel",sub:"Sousse",cat:"attraction",lt:35.85,lg:10.59,rt:4.5,dur:60,cost:0,hid:true,sn:["printemps","automne"],cr:.08,d:"Village berb√®re perch√© spectaculaire.",meal:null},
  {id:"m_rib",n:"Ribat Monastir",r:"sahel",sub:"Monastir",cat:"attraction",lt:35.78,lg:10.83,rt:4.3,dur:50,cost:8,hid:false,sn:["printemps","ete","automne","hiver"],cr:.50,d:"Forteresse VIIIe, lieu de tournage.",meal:null},
  {id:"bourg_m",n:"Mausol√©e Bourguiba",r:"sahel",sub:"Monastir",cat:"attraction",lt:35.78,lg:10.83,rt:4.2,dur:30,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.40,d:"Monument dor√© imposant.",meal:null},
  {id:"marina_m",n:"Marina Monastir",r:"sahel",sub:"Monastir",cat:"cafe",lt:35.78,lg:10.84,rt:4.0,dur:40,cost:12,hid:false,sn:["printemps","ete","automne"],cr:.45,d:"Brunch face aux yachts.",meal:"breakfast"},
  {id:"neptune",n:"Le Neptune",r:"sahel",sub:"Mahdia",cat:"restaurant",lt:35.51,lg:11.05,rt:4.3,dur:70,cost:25,hid:true,sn:["printemps","ete","automne"],cr:.20,d:"Poisson grill√© au port de Mahdia.",meal:"dinner"},
  {id:"eljem",n:"Amphith√©√¢tre El Jem",r:"centre",sub:"El Jem",cat:"attraction",lt:35.30,lg:10.71,rt:4.9,dur:80,cost:12,hid:false,sn:["printemps","automne","hiver"],cr:.55,d:"3√®me colis√©e romain. UNESCO.",meal:null},
  {id:"tabarka",n:"Tabarka",r:"nord_ouest",sub:"Tabarka",cat:"nature",lt:36.95,lg:8.76,rt:4.4,dur:120,cost:0,hid:false,sn:["ete","printemps"],cr:.32,d:"C√¥te de corail, Les Aiguilles.",meal:null},
  {id:"fort_g",n:"Fort G√©nois",r:"nord_ouest",sub:"Tabarka",cat:"attraction",lt:36.96,lg:8.75,rt:4.2,dur:40,cost:0,hid:true,sn:["printemps","ete","automne"],cr:.20,d:"Forteresse g√©noise sur √Æle rocheuse.",meal:null},
  {id:"resto_tab",n:"Chez Nous",r:"nord_ouest",sub:"Tabarka",cat:"restaurant",lt:36.95,lg:8.76,rt:4.2,dur:65,cost:28,hid:false,sn:["printemps","ete","automne"],cr:.25,d:"Langoustes du corail.",meal:"lunch"},
  {id:"ain_d",n:"A√Øn Draham",r:"nord_ouest",sub:"A√Øn Draham",cat:"nature",lt:36.78,lg:8.68,rt:4.3,dur:90,cost:0,hid:true,sn:["ete","printemps","automne"],cr:.15,d:"Village montagne 800m, for√™ts de ch√™nes.",meal:null},
  {id:"cafe_f",n:"Caf√© de la For√™t",r:"nord_ouest",sub:"A√Øn Draham",cat:"cafe",lt:36.79,lg:8.68,rt:4.1,dur:35,cost:8,hid:true,sn:["ete","printemps","automne"],cr:.10,d:"Th√© sous les ch√™nes-li√®ges centenaires.",meal:"breakfast"},
  {id:"bulla",n:"Bulla Regia",r:"nord_ouest",sub:"Bulla Regia",cat:"attraction",lt:36.56,lg:8.76,rt:4.5,dur:80,cost:7,hid:true,sn:["printemps","ete","automne"],cr:.12,d:"Villas romaines souterraines uniques.",meal:null},
  {id:"bizerte",n:"Vieux Port Bizerte",r:"nord_est",sub:"Bizerte",cat:"attraction",lt:37.27,lg:9.87,rt:4.2,dur:70,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.35,d:"Port pittoresque, Kasbah color√©e.",meal:null},
  {id:"mousse",n:"Le Petit Mousse",r:"nord_est",sub:"Bizerte",cat:"restaurant",lt:37.28,lg:9.88,rt:4.3,dur:65,cost:25,hid:false,sn:["printemps","ete","automne"],cr:.30,d:"Poissons grill√©s face au port.",meal:"lunch"},
  {id:"ichkeul",n:"Parc Ichkeul",r:"nord_est",sub:"Ichkeul",cat:"nature",lt:37.16,lg:9.67,rt:4.6,dur:100,cost:5,hid:true,sn:["hiver","automne","printemps"],cr:.10,d:"UNESCO. Flamants roses, lac unique.",meal:null},
  {id:"cafe_biz",n:"Caf√© du Port",r:"nord_est",sub:"Bizerte",cat:"cafe",lt:37.27,lg:9.87,rt:4.0,dur:35,cost:7,hid:false,sn:["printemps","ete","automne"],cr:.30,d:"Bambalouni et caf√© au lait matinal.",meal:"breakfast"},
  {id:"dougga",n:"Dougga",r:"nord_ouest",sub:"Testour & Dougga",cat:"attraction",lt:36.42,lg:9.22,rt:4.8,dur:100,cost:8,hid:false,sn:["printemps","automne"],cr:.22,d:"Meilleur site romain d'Afrique. UNESCO.",meal:null},
  {id:"testour",n:"Testour",r:"nord_ouest",sub:"Testour & Dougga",cat:"attraction",lt:36.55,lg:9.45,rt:4.1,dur:50,cost:0,hid:true,sn:["printemps","automne"],cr:.08,d:"Village andalou, horloge invers√©e.",meal:null},
  {id:"jugurtha",n:"Table de Jugurtha",r:"nord_ouest",sub:"Le Kef",cat:"nature",lt:35.79,lg:8.39,rt:4.7,dur:100,cost:5,hid:true,sn:["printemps","automne"],cr:.05,d:"Mesa 1271m, randonn√©e mythique.",meal:null},
  {id:"h_med",n:"M√©dina Hammamet",r:"cap_bon",sub:"Hammamet",cat:"attraction",lt:36.39,lg:10.61,rt:4.3,dur:50,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.65,d:"M√©dina fortifi√©e face mer, jasmin.",meal:null},
  {id:"h_pl",n:"Plage Hammamet",r:"cap_bon",sub:"Hammamet",cat:"beach",lt:36.40,lg:10.62,rt:4.4,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.60,d:"Sable fin, eaux turquoise.",meal:null},
  {id:"bella",n:"La Bella Marina",r:"cap_bon",sub:"Hammamet",cat:"restaurant",lt:36.40,lg:10.61,rt:4.4,dur:70,cost:35,hid:false,sn:["printemps","ete","automne"],cr:.50,d:"Tuniso-italienne, terrasse mer.",meal:"dinner"},
  {id:"nabeul",n:"Nabeul Poteries",r:"cap_bon",sub:"Nabeul",cat:"attraction",lt:36.45,lg:10.74,rt:4.1,dur:70,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.45,d:"Capitale de la poterie tunisienne.",meal:null},
  {id:"cafe_hamm",n:"Caf√© Sidi Bouhdid",r:"cap_bon",sub:"Hammamet",cat:"cafe",lt:36.39,lg:10.61,rt:4.3,dur:35,cost:10,hid:false,sn:["printemps","ete","automne"],cr:.55,d:"Bambalouni vue mer, petit-d√©j.",meal:"breakfast"},
  {id:"k_mosq",n:"Grande Mosqu√©e",r:"centre",sub:"Kairouan",cat:"mosque",lt:35.68,lg:10.10,rt:4.8,dur:50,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.60,d:"4√®me lieu saint Islam. Fond√©e 670.",meal:null},
  {id:"k_med",n:"M√©dina Kairouan",r:"centre",sub:"Kairouan",cat:"attraction",lt:35.68,lg:10.10,rt:4.4,dur:70,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.50,d:"UNESCO. Tapis, makroudh artisanal.",meal:null},
  {id:"aghlab",n:"Bassins Aghlabides",r:"centre",sub:"Kairouan",cat:"attraction",lt:35.69,lg:10.11,rt:4.3,dur:40,cost:5,hid:true,sn:["printemps","automne","hiver"],cr:.35,d:"Prouesse hydraulique IXe si√®cle.",meal:null},
  {id:"bouzid",n:"P√¢tisserie Bouzid",r:"centre",sub:"Kairouan",cat:"cafe",lt:35.68,lg:10.10,rt:4.5,dur:30,cost:5,hid:false,sn:["printemps","ete","automne","hiver"],cr:.50,d:"Meilleurs makroudh de Kairouan.",meal:"breakfast"},
  {id:"tozeur",n:"Palmeraie Tozeur",r:"sud_ouest",sub:"Tozeur",cat:"nature",lt:33.92,lg:8.13,rt:4.6,dur:90,cost:5,hid:false,sn:["automne","hiver","printemps"],cr:.38,d:"400 000 palmiers mill√©naires.",meal:null},
  {id:"tozeur_v",n:"Ouled El Hadef",r:"sud_ouest",sub:"Tozeur",cat:"attraction",lt:33.92,lg:8.13,rt:4.3,dur:50,cost:0,hid:true,sn:["automne","hiver","printemps"],cr:.30,d:"Briques jaunes g√©om√©triques.",meal:null},
  {id:"chott",n:"Chott el-J√©rid",r:"sud_ouest",sub:"Tozeur",cat:"nature",lt:33.75,lg:8.42,rt:4.5,dur:50,cost:0,hid:false,sn:["automne","hiver","printemps"],cr:.15,d:"Lac sal√© 5000km2. Mirages.",meal:null},
  {id:"dar_toz",n:"Dar Tozeur",r:"sud_ouest",sub:"Tozeur",cat:"restaurant",lt:33.92,lg:8.13,rt:4.4,dur:70,cost:25,hid:false,sn:["automne","hiver","printemps"],cr:.25,d:"Couscous berzguen, sp√©cialit√© locale.",meal:"dinner"},
  {id:"chebika",n:"Oasis Chebika",r:"sud_ouest",sub:"Nefta & Chebika",cat:"nature",lt:34.32,lg:7.94,rt:4.7,dur:80,cost:0,hid:true,sn:["automne","hiver","printemps"],cr:.20,d:"Cascade cach√©e dans les gorges.",meal:null},
  {id:"mides",n:"Canyon Mides",r:"sud_ouest",sub:"Tamerza",cat:"nature",lt:34.38,lg:7.90,rt:4.5,dur:60,cost:0,hid:true,sn:["automne","hiver","printemps"],cr:.10,d:"Gorges vertigineuses.",meal:null},
  {id:"ong",n:"Ong Jmal Star Wars",r:"sud_ouest",sub:"Nefta & Chebika",cat:"attraction",lt:34.40,lg:7.85,rt:4.2,dur:50,cost:5,hid:true,sn:["automne","hiver","printemps"],cr:.12,d:"D√©cors Mos Espa dans le sable.",meal:null},
  {id:"matmata",n:"Matmata Troglodytes",r:"sud_est",sub:"Matmata",cat:"attraction",lt:33.54,lg:9.98,rt:4.4,dur:70,cost:5,hid:false,sn:["automne","hiver","printemps"],cr:.30,d:"Habitations berb√®res Star Wars.",meal:null},
  {id:"douz",n:"Douz Sahara",r:"sud_ouest",sub:"Douz",cat:"nature",lt:33.46,lg:8.83,rt:4.3,dur:120,cost:35,hid:false,sn:["automne","hiver"],cr:.28,d:"Porte du Sahara. Dromadaires, dunes.",meal:null},
  {id:"ksar_o",n:"Ksour Tataouine",r:"sud_est",sub:"Tataouine",cat:"attraction",lt:32.93,lg:10.45,rt:4.4,dur:80,cost:5,hid:true,sn:["automne","hiver","printemps"],cr:.08,d:"Greniers berb√®res mill√©naires.",meal:null},
  {id:"chenini",n:"Village Chenini",r:"sud_est",sub:"Tataouine",cat:"attraction",lt:33.01,lg:10.26,rt:4.5,dur:70,cost:0,hid:true,sn:["automne","hiver","printemps"],cr:.05,d:"Troglodyte perch√© l√©gendaire.",meal:null},
  {id:"houmt",n:"Houmt Souk",r:"djerba",sub:"Houmt Souk",cat:"attraction",lt:33.88,lg:10.86,rt:4.3,dur:90,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.55,d:"Fondouks, march√©s berb√®res.",meal:null},
  {id:"yedder",n:"Caf√© Ben Yedder",r:"djerba",sub:"Houmt Souk",cat:"cafe",lt:33.88,lg:10.86,rt:4.2,dur:40,cost:8,hid:false,sn:["printemps","ete","automne","hiver"],cr:.40,d:"Ftour, th√© vert, p√¢tisseries.",meal:"breakfast"},
  {id:"atik",n:"Al Atik",r:"djerba",sub:"Houmt Souk",cat:"restaurant",lt:33.88,lg:10.86,rt:4.4,dur:70,cost:30,hid:false,sn:["printemps","ete","automne","hiver"],cr:.45,d:"Cuisine djerbienne, poisson du jour.",meal:"lunch"},
  {id:"ghriba",n:"Synagogue Ghriba",r:"djerba",sub:"Erriadh",cat:"attraction",lt:33.81,lg:10.86,rt:4.5,dur:40,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.40,d:"Plus ancienne synagogue d'Afrique.",meal:null},
  {id:"djhood",n:"Djerbahood",r:"djerba",sub:"Erriadh",cat:"attraction",lt:33.82,lg:10.86,rt:4.6,dur:70,cost:0,hid:true,sn:["printemps","ete","automne","hiver"],cr:.30,d:"250 fresques street art, 30 pays.",meal:null},
  {id:"seguia",n:"Plage Seguia",r:"djerba",sub:"Midoun",cat:"beach",lt:33.80,lg:10.96,rt:4.4,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.45,d:"Paradis turquoise.",meal:null},
  {id:"dar_dj",n:"Dar Hassine",r:"djerba",sub:"Midoun",cat:"restaurant",lt:33.80,lg:10.92,rt:4.5,dur:75,cost:35,hid:true,sn:["printemps","ete","automne","hiver"],cr:.25,d:"Table raffin√©e djerbienne.",meal:"dinner"},
  {id:"sfax_m",n:"M√©dina Sfax",r:"sfax",sub:"Sfax Ville",cat:"attraction",lt:34.74,lg:10.76,rt:4.2,dur:70,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.40,d:"Remparts majestueux, Bab Diwan.",meal:null},
  {id:"kerk",n:"√éles Kerkennah",r:"sfax",sub:"Kerkennah",cat:"nature",lt:34.70,lg:11.17,rt:4.3,dur:150,cost:3,hid:true,sn:["printemps","ete","automne"],cr:.08,d:"Archipel pr√©serv√©, p√™che.",meal:null},
  // === EXPANDED DESTINATIONS ===
  // TUNIS +
  {id:"cathedrale",n:"Cath√©drale St-Vincent",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.80,lg:10.18,rt:4.0,dur:30,cost:0,hid:true,sn:["printemps","ete","automne","hiver"],cr:.20,d:"Architecture n√©o-romane, vitraux magnifiques.",meal:null},
  {id:"dar_lasram",n:"Dar Lasram",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.80,lg:10.17,rt:4.3,dur:40,cost:5,hid:true,sn:["printemps","ete","automne","hiver"],cr:.15,d:"Palais beylical XVIIIe, zellige exquis.",meal:null},
  {id:"dar_hussein",n:"Dar Hussein",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.80,lg:10.17,rt:4.4,dur:45,cost:5,hid:true,sn:["printemps","ete","automne","hiver"],cr:.18,d:"INP, architecture ottomane splendide.",meal:null},
  {id:"zitouna",n:"Mosqu√©e Zitouna",r:"tunis",sub:"Tunis Centre",cat:"mosque",lt:36.80,lg:10.17,rt:4.6,dur:25,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.70,d:"Fond√©e en 732, c≈ìur spirituel de Tunis.",meal:null},
  {id:"musee_cart",n:"Mus√©e Carthage",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"attraction",lt:36.85,lg:10.32,rt:4.3,dur:50,cost:8,hid:false,sn:["printemps","automne","hiver"],cr:.50,d:"St√®les puniques, sarcophages, bijoux anciens.",meal:null},
  {id:"thermes",n:"Thermes d'Antonin",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"attraction",lt:36.86,lg:10.33,rt:4.5,dur:50,cost:12,hid:false,sn:["printemps","automne","hiver"],cr:.60,d:"Plus grands thermes romains d'Afrique.",meal:null},
  {id:"acropolium",n:"Acropolium Carthage",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"attraction",lt:36.85,lg:10.33,rt:4.2,dur:35,cost:5,hid:true,sn:["printemps","ete","automne","hiver"],cr:.25,d:"Ancienne cath√©drale, concerts, expo.",meal:null},
  {id:"gammarth_pl",n:"Plage Gammarth",r:"tunis",sub:"La Marsa & Gammarth",cat:"beach",lt:36.91,lg:10.30,rt:4.1,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.55,d:"Plage r√©sidentielle chic, sable fin.",meal:null},
  {id:"dar_seb",n:"Dar Sebastian",r:"tunis",sub:"La Marsa & Gammarth",cat:"attraction",lt:36.89,lg:10.32,rt:4.0,dur:40,cost:5,hid:true,sn:["printemps","ete","automne"],cr:.08,d:"Villa art-d√©co, jardin romantique.",meal:null},
  {id:"cafe_saf",n:"Caf√© Saf Saf",r:"tunis",sub:"La Marsa & Gammarth",cat:"cafe",lt:36.88,lg:10.33,rt:4.3,dur:40,cost:10,hid:false,sn:["printemps","ete","automne","hiver"],cr:.45,d:"Caf√© centenaire sous grand ficus, narguil√©.",meal:"breakfast"},
  // SAHEL +
  {id:"ribat_s",n:"Ribat Sousse",r:"sahel",sub:"Sousse",cat:"attraction",lt:35.83,lg:10.64,rt:4.4,dur:45,cost:8,hid:false,sn:["printemps","ete","automne","hiver"],cr:.55,d:"Tour de guet VIIIe, vue panoramique.",meal:null},
  {id:"catacombes",n:"Catacombes Sousse",r:"sahel",sub:"Sousse",cat:"attraction",lt:35.82,lg:10.64,rt:4.1,dur:40,cost:5,hid:true,sn:["printemps","automne","hiver"],cr:.15,d:"R√©seau souterrain chr√©tien, 5km galeries.",meal:null},
  {id:"boujaafar",n:"Plage Bouja√¢far",r:"sahel",sub:"Sousse",cat:"beach",lt:35.83,lg:10.65,rt:4.0,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.65,d:"Plage urbaine anim√©e face au Ribat.",meal:null},
  {id:"musee_s",n:"Mus√©e Arch√©o Sousse",r:"sahel",sub:"Sousse",cat:"attraction",lt:35.83,lg:10.63,rt:4.2,dur:50,cost:7,hid:true,sn:["printemps","automne","hiver"],cr:.20,d:"Mosa√Øques romaines exceptionnelles.",meal:null},
  {id:"habib_r",n:"Restaurant Habib",r:"sahel",sub:"Sousse",cat:"restaurant",lt:35.83,lg:10.64,rt:4.2,dur:65,cost:20,hid:false,sn:["printemps","ete","automne","hiver"],cr:.40,d:"Tajine poisson, sp√©cialit√©s sah√©liennes.",meal:"lunch"},
  {id:"dar_am",n:"Dar Amira",r:"sahel",sub:"Sousse",cat:"restaurant",lt:35.83,lg:10.63,rt:4.5,dur:70,cost:35,hid:true,sn:["printemps","ete","automne","hiver"],cr:.20,d:"Palais restaur√©, gastronomie fine.",meal:"dinner"},
  {id:"skanes_pl",n:"Plage Skanes",r:"sahel",sub:"Monastir",cat:"beach",lt:35.77,lg:10.75,rt:4.2,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.50,d:"Longue plage de sable fin, eaux calmes.",meal:null},
  {id:"habib_mus",n:"Mus√©e Habib Bourguiba",r:"sahel",sub:"Monastir",cat:"attraction",lt:35.78,lg:10.83,rt:4.0,dur:40,cost:5,hid:false,sn:["printemps","ete","automne","hiver"],cr:.35,d:"Vie du p√®re de la nation.",meal:null},
  {id:"mahdia_med",n:"M√©dina Mahdia",r:"sahel",sub:"Mahdia",cat:"attraction",lt:35.50,lg:11.04,rt:4.3,dur:70,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.30,d:"Skifa Kahla, tisserands soie.",meal:null},
  {id:"mahdia_pl",n:"Plage Mahdia",r:"sahel",sub:"Mahdia",cat:"beach",lt:35.50,lg:11.06,rt:4.5,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.35,d:"Sable blanc fin, mer transparente.",meal:null},
  {id:"borj_m",n:"Borj El Kebir",r:"sahel",sub:"Mahdia",cat:"attraction",lt:35.51,lg:11.06,rt:4.1,dur:35,cost:5,hid:true,sn:["printemps","automne","hiver"],cr:.15,d:"Fort fatimide XVI, vue cap Afrique.",meal:null},
  {id:"port_mahdia",n:"Port de Mahdia",r:"sahel",sub:"Mahdia",cat:"attraction",lt:35.50,lg:11.05,rt:4.2,dur:30,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"Port color√©, barques bleues, p√™cheurs.",meal:null},
  // NORD-OUEST +
  {id:"corail",n:"C√¥te de Corail",r:"nord_ouest",sub:"Tabarka",cat:"nature",lt:36.95,lg:8.78,rt:4.5,dur:80,cost:0,hid:false,sn:["ete","printemps"],cr:.20,d:"Fonds marins, plong√©e, roches rouges.",meal:null},
  {id:"pl_tabarka",n:"Plage Tabarka",r:"nord_ouest",sub:"Tabarka",cat:"beach",lt:36.96,lg:8.74,rt:4.3,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.25,d:"Sable fin, Aiguilles rocheuses en fond.",meal:null},
  {id:"foret_bou",n:"For√™t Boukornine",r:"nord_ouest",sub:"A√Øn Draham",cat:"nature",lt:36.78,lg:8.70,rt:4.2,dur:70,cost:0,hid:true,sn:["printemps","ete","automne"],cr:.05,d:"Randonn√©e en for√™t de ch√™nes-li√®ges.",meal:null},
  {id:"hammam_b",n:"Hammam Bourguiba",r:"nord_ouest",sub:"A√Øn Draham",cat:"nature",lt:36.80,lg:8.73,rt:4.0,dur:60,cost:10,hid:true,sn:["printemps","automne","hiver"],cr:.08,d:"Sources thermales naturelles en for√™t.",meal:null},
  {id:"chimtou",n:"Chimtou",r:"nord_ouest",sub:"Bulla Regia",cat:"attraction",lt:36.49,lg:8.58,rt:4.1,dur:60,cost:5,hid:true,sn:["printemps","automne"],cr:.05,d:"Carri√®res marbre numide, mus√©e.",meal:null},
  // NORD-EST +
  {id:"fort_biz",n:"Fort d'Espagne",r:"nord_est",sub:"Bizerte",cat:"attraction",lt:37.28,lg:9.87,rt:4.1,dur:40,cost:3,hid:false,sn:["printemps","ete","automne"],cr:.25,d:"Fort ottoman, vue panoramique port.",meal:null},
  {id:"kasbah_biz",n:"Kasbah Bizerte",r:"nord_est",sub:"Bizerte",cat:"attraction",lt:37.27,lg:9.87,rt:4.0,dur:35,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Quartier historique, ruelles color√©es.",meal:null},
  {id:"cafe_biz2",n:"Caf√© du Port",r:"nord_est",sub:"Bizerte",cat:"cafe",lt:37.27,lg:9.87,rt:4.1,dur:35,cost:8,hid:false,sn:["printemps","ete","automne"],cr:.30,d:"Vue vieux port, caf√© turc.",meal:"breakfast"},
  {id:"resto_biz",n:"Le Ph√©nicien",r:"nord_est",sub:"Bizerte",cat:"restaurant",lt:37.28,lg:9.88,rt:4.3,dur:70,cost:30,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"Fruits de mer, terrasse sur le port.",meal:"dinner"},
  {id:"corniche_biz",n:"Corniche Bizerte",r:"nord_est",sub:"Bizerte",cat:"nature",lt:37.28,lg:9.85,rt:4.0,dur:50,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.30,d:"Promenade littorale, coucher soleil.",meal:null},
  // CENTRE +
  {id:"kef",n:"Kasbah Le Kef",r:"nord_ouest",sub:"Le Kef",cat:"attraction",lt:36.18,lg:8.71,rt:4.3,dur:60,cost:3,hid:true,sn:["printemps","automne"],cr:.08,d:"Citadelle ottomane, vue 360¬∞ vall√©e.",meal:null},
  {id:"basilique",n:"Basilique Le Kef",r:"nord_ouest",sub:"Le Kef",cat:"attraction",lt:36.17,lg:8.71,rt:4.0,dur:30,cost:0,hid:true,sn:["printemps","automne","hiver"],cr:.05,d:"Pal√©ochr√©tienne IVe, une des plus anciennes.",meal:null},
  {id:"table_jug",n:"Table de Jugurtha",r:"nord_ouest",sub:"Le Kef",cat:"nature",lt:36.14,lg:8.37,rt:4.6,dur:90,cost:5,hid:true,sn:["printemps","automne"],cr:.03,d:"Mesa spectaculaire, forteresse naturelle.",meal:null},
  {id:"cafe_kef",n:"Caf√© Andalous Le Kef",r:"nord_ouest",sub:"Le Kef",cat:"cafe",lt:36.17,lg:8.71,rt:4.0,dur:30,cost:6,hid:true,sn:["printemps","ete","automne","hiver"],cr:.05,d:"Plus vieux caf√© du Kef, vue m√©dina.",meal:"breakfast"},
  // CAP BON +
  {id:"fort_kel",n:"Fort K√©libia",r:"cap_bon",sub:"K√©libia",cat:"attraction",lt:36.85,lg:11.10,rt:4.3,dur:50,cost:5,hid:false,sn:["printemps","ete","automne"],cr:.30,d:"Plus grand fort byzantin, vue 360¬∞.",meal:null},
  {id:"korbous",n:"Korbous Thermes",r:"cap_bon",sub:"Korbus",cat:"nature",lt:36.82,lg:10.57,rt:4.1,dur:70,cost:10,hid:true,sn:["printemps","automne","hiver"],cr:.10,d:"Sources thermales chaudes, falaises.",meal:null},
  {id:"haouaria",n:"Grottes El Haouaria",r:"cap_bon",sub:"El Haouaria",cat:"nature",lt:37.05,lg:11.01,rt:4.2,dur:50,cost:3,hid:true,sn:["printemps","ete","automne"],cr:.10,d:"Carri√®res romaines, fauconnerie.",meal:null},
  {id:"yasmine_h",n:"Yasmine Hammamet",r:"cap_bon",sub:"Hammamet",cat:"attraction",lt:36.38,lg:10.55,rt:4.0,dur:80,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.60,d:"Marina, restos, souk reconstitu√©.",meal:null},
  {id:"cafe_kel",n:"Caf√© El Mansourah",r:"cap_bon",sub:"K√©libia",cat:"cafe",lt:36.84,lg:11.09,rt:4.2,dur:35,cost:8,hid:false,sn:["printemps","ete","automne"],cr:.15,d:"Vue falaises, th√© au soleil.",meal:"breakfast"},
  {id:"dar_kel",n:"Le P√™cheur K√©libia",r:"cap_bon",sub:"K√©libia",cat:"restaurant",lt:36.85,lg:11.10,rt:4.4,dur:70,cost:30,hid:false,sn:["printemps","ete","automne"],cr:.20,d:"Poisson fra√Æchement p√™ch√©, terrasse mer.",meal:"dinner"},
  // KAIROUAN +
  {id:"k_med_souk",n:"Souk M√©dina Kairouan",r:"centre",sub:"Kairouan",cat:"attraction",lt:35.68,lg:10.10,rt:4.2,dur:60,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.45,d:"Tapis, cuir, makroudh artisanaux.",meal:null},
  {id:"sidi_sahbi",n:"Mosqu√©e Sidi Sahbi",r:"centre",sub:"Kairouan",cat:"mosque",lt:35.67,lg:10.09,rt:4.4,dur:30,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.35,d:"Mosqu√©e du Barbier, fa√Øences turques.",meal:null},
  {id:"bir_b",n:"Bassins Aghlabides",r:"centre",sub:"Kairouan",cat:"attraction",lt:35.68,lg:10.11,rt:4.1,dur:25,cost:3,hid:false,sn:["printemps","automne","hiver"],cr:.25,d:"G√©nie hydraulique IXe si√®cle.",meal:null},
  {id:"cafe_kairouan",n:"Caf√© El Amir",r:"centre",sub:"Kairouan",cat:"cafe",lt:35.68,lg:10.10,rt:4.0,dur:30,cost:6,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Makroudh frais, th√© devant m√©dina.",meal:"breakfast"},
  {id:"resto_kairouan",n:"El Barrouta",r:"centre",sub:"Kairouan",cat:"restaurant",lt:35.68,lg:10.10,rt:4.2,dur:65,cost:22,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Couscous bel kaddid, agneau local.",meal:"lunch"},
  // SUD-OUEST +
  {id:"nefta",n:"Corbeille Nefta",r:"sud_ouest",sub:"Nefta & Chebika",cat:"nature",lt:33.87,lg:7.88,rt:4.3,dur:50,cost:0,hid:false,sn:["automne","hiver","printemps"],cr:.12,d:"Oasis en cuvette, 152 sources.",meal:null},
  {id:"tamerza_pal",n:"Cascades Tamerza",r:"sud_ouest",sub:"Tamerza",cat:"nature",lt:34.38,lg:7.95,rt:4.4,dur:60,cost:0,hid:false,sn:["automne","hiver","printemps"],cr:.12,d:"Oasis de montagne, cascades cach√©es.",meal:null},
  {id:"tozeur_zoo",n:"Eden Palm Tozeur",r:"sud_ouest",sub:"Tozeur",cat:"nature",lt:33.93,lg:8.10,rt:4.0,dur:50,cost:8,hid:false,sn:["automne","hiver","printemps"],cr:.15,d:"Parc √©co, faune saharienne.",meal:null},
  {id:"cafe_toz",n:"Caf√© Bir Barrouta",r:"sud_ouest",sub:"Tozeur",cat:"cafe",lt:33.92,lg:8.13,rt:4.1,dur:30,cost:5,hid:false,sn:["automne","hiver","printemps"],cr:.15,d:"Puits ancestral, dromadaire actionne la pompe.",meal:"breakfast"},
  // SUD-EST +
  {id:"guerm",n:"Guermessa",r:"sud_est",sub:"Tataouine",cat:"attraction",lt:32.99,lg:10.37,rt:4.3,dur:60,cost:0,hid:true,sn:["automne","hiver","printemps"],cr:.03,d:"Village perch√© abandonn√©, vue saisissante.",meal:null},
  {id:"ksar_h",n:"Ksar Haddada",r:"sud_est",sub:"Tataouine",cat:"attraction",lt:33.16,lg:10.34,rt:4.2,dur:45,cost:3,hid:true,sn:["automne","hiver","printemps"],cr:.05,d:"Lieu de tournage Star Wars, h√¥tel insolite.",meal:null},
  {id:"cafe_douz",n:"Caf√© des Dunes",r:"sud_ouest",sub:"Douz",cat:"cafe",lt:33.46,lg:8.83,rt:4.0,dur:35,cost:6,hid:false,sn:["automne","hiver"],cr:.15,d:"Th√© b√©douin face au d√©sert.",meal:"breakfast"},
  {id:"dar_mat",n:"Dar Troglodyte",r:"sud_est",sub:"Matmata",cat:"restaurant",lt:33.54,lg:9.98,rt:4.2,dur:65,cost:20,hid:false,sn:["automne","hiver","printemps"],cr:.20,d:"Repas berb√®re dans maison souterraine.",meal:"lunch"},
  // DJERBA +
  {id:"borj_dj",n:"Borj El Kebir Djerba",r:"djerba",sub:"Houmt Souk",cat:"attraction",lt:33.88,lg:10.85,rt:4.1,dur:35,cost:5,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Fort espagnol XVe, tour des cr√¢nes.",meal:null},
  {id:"flamant",n:"Plage des Flamants",r:"djerba",sub:"Midoun",cat:"beach",lt:33.82,lg:11.00,rt:4.6,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.20,d:"Flamants roses, lagune turquoise.",meal:null},
  {id:"musee_dj",n:"Mus√©e Guellala",r:"djerba",sub:"Erriadh",cat:"attraction",lt:33.75,lg:10.85,rt:4.0,dur:45,cost:7,hid:true,sn:["printemps","ete","automne","hiver"],cr:.15,d:"Traditions djerbiennes, poterie mill√©naire.",meal:null},
  {id:"crocodile",n:"Ferme Crocodiles",r:"djerba",sub:"Midoun",cat:"nature",lt:33.80,lg:10.93,rt:4.1,dur:50,cost:15,hid:false,sn:["printemps","ete","automne","hiver"],cr:.40,d:"400 crocodiles du Nil, jardin tropical.",meal:null},
  {id:"cafe_erriadh",n:"Caf√© Fatma",r:"djerba",sub:"Erriadh",cat:"cafe",lt:33.82,lg:10.86,rt:4.2,dur:35,cost:8,hid:true,sn:["printemps","ete","automne","hiver"],cr:.10,d:"Caf√© au milieu des fresques, homemade.",meal:"breakfast"},
  // SFAX +
  {id:"sfax_dar",n:"Dar Jellouli",r:"sfax",sub:"Sfax Ville",cat:"attraction",lt:34.74,lg:10.76,rt:4.1,dur:40,cost:5,hid:true,sn:["printemps","automne","hiver"],cr:.15,d:"Mus√©e arts et traditions dans palais XVIIe.",meal:null},
  {id:"sfax_bab",n:"Bab Diwan",r:"sfax",sub:"Sfax Ville",cat:"attraction",lt:34.74,lg:10.76,rt:4.0,dur:20,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.35,d:"Porte monumentale, entr√©e m√©dina.",meal:null},
  {id:"cafe_sfax",n:"Caf√© El Diwan",r:"sfax",sub:"Sfax Ville",cat:"cafe",lt:34.74,lg:10.76,rt:4.0,dur:30,cost:6,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"Face aux remparts, ambiance locale.",meal:"breakfast"},
  {id:"resto_sfax",n:"Chez Abid",r:"sfax",sub:"Sfax Ville",cat:"restaurant",lt:34.74,lg:10.77,rt:4.3,dur:65,cost:20,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Meilleur poisson grill√© de Sfax.",meal:"lunch"},
  // === MORE EXPANDED DESTINATIONS V10 ===
  // TUNIS ++
  {id:"souk_att",n:"Souk El Attarine",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.80,lg:10.17,rt:4.3,dur:40,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.55,d:"Souk des parfumeurs, essences et √©pices rares.",meal:null},
  {id:"tourbet",n:"Tourbet El Bey",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.80,lg:10.17,rt:4.2,dur:35,cost:5,hid:true,sn:["printemps","automne","hiver"],cr:.12,d:"Mausol√©e royal husseinite, marbre et fa√Øences.",meal:null},
  {id:"dar_bach",n:"Dar Bach Hamba",r:"tunis",sub:"Tunis Centre",cat:"attraction",lt:36.80,lg:10.17,rt:4.1,dur:30,cost:3,hid:true,sn:["printemps","ete","automne","hiver"],cr:.08,d:"Palais historique, expositions temporaires.",meal:null},
  {id:"resto_marsa",n:"Le Golfe La Marsa",r:"tunis",sub:"La Marsa & Gammarth",cat:"restaurant",lt:36.88,lg:10.33,rt:4.4,dur:70,cost:45,hid:false,sn:["printemps","ete","automne","hiver"],cr:.35,d:"Terrasse mer, fruits de mer premium.",meal:"dinner"},
  // SAHEL ++
  {id:"musee_sousse2",n:"Mus√©e Dar Essid",r:"sahel",sub:"Sousse",cat:"attraction",lt:35.83,lg:10.63,rt:4.3,dur:40,cost:5,hid:true,sn:["printemps","automne","hiver"],cr:.12,d:"Maison X si√®cle, mobilier ancien, vue m√©dina.",meal:null},
  {id:"souk_jem",n:"Souk El Jem",r:"centre",sub:"El Jem",cat:"attraction",lt:35.30,lg:10.71,rt:4.0,dur:30,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.35,d:"Olives, tapis, artisanat berb√®re.",meal:null},
  {id:"cafe_eljem",n:"Caf√© du Colis√©e",r:"centre",sub:"El Jem",cat:"cafe",lt:35.30,lg:10.71,rt:4.1,dur:30,cost:6,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Vue directe amphith√©√¢tre, jus frais.",meal:"breakfast"},
  {id:"resto_monastir",n:"Le Pirate Monastir",r:"sahel",sub:"Monastir",cat:"restaurant",lt:35.78,lg:10.83,rt:4.2,dur:65,cost:28,hid:false,sn:["printemps","ete","automne","hiver"],cr:.35,d:"Poisson grill√©, terrasse port.",meal:"dinner"},
  {id:"monastir_corniche",n:"Corniche Monastir",r:"sahel",sub:"Monastir",cat:"nature",lt:35.77,lg:10.83,rt:4.0,dur:40,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.40,d:"Promenade littorale, falaise et mer.",meal:null},
  // CAP BON ++
  {id:"pl_hammamet",n:"Plage Hammamet",r:"cap_bon",sub:"Hammamet",cat:"beach",lt:36.40,lg:10.62,rt:4.3,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.60,d:"Sable dor√©, eaux calmes, anim√©e.",meal:null},
  {id:"medina_ham",n:"M√©dina Hammamet",r:"cap_bon",sub:"Hammamet",cat:"attraction",lt:36.40,lg:10.61,rt:4.2,dur:50,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.55,d:"Remparts face mer, ruelles fleuries.",meal:null},
  {id:"george_seb",n:"Villa George Sebastian",r:"cap_bon",sub:"Hammamet",cat:"attraction",lt:36.39,lg:10.62,rt:4.1,dur:40,cost:5,hid:true,sn:["printemps","ete","automne"],cr:.15,d:"Villa Art D√©co 1920, jardins exotiques.",meal:null},
  {id:"resto_ham",n:"La Bella Marina",r:"cap_bon",sub:"Hammamet",cat:"restaurant",lt:36.40,lg:10.61,rt:4.3,dur:65,cost:35,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Pasta fruits de mer, vue Yasmine.",meal:"lunch"},
  {id:"cafe_ham",n:"Caf√© Sidi Bouhdid",r:"cap_bon",sub:"Hammamet",cat:"cafe",lt:36.40,lg:10.61,rt:4.2,dur:35,cost:8,hid:false,sn:["printemps","ete","automne","hiver"],cr:.40,d:"Terrasse m√©dina, vue golfe, th√© menthe.",meal:"breakfast"},
  {id:"pl_nabeul",n:"Plage Nabeul",r:"cap_bon",sub:"Nabeul",cat:"beach",lt:36.45,lg:10.75,rt:4.0,dur:90,cost:0,hid:false,sn:["ete","printemps"],cr:.35,d:"Plage familiale calme, peu touristique.",meal:null},
  // NORD-OUEST ++
  {id:"aig_tab",n:"Aiguilles Tabarka",r:"nord_ouest",sub:"Tabarka",cat:"nature",lt:36.96,lg:8.76,rt:4.4,dur:40,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.20,d:"Formations rocheuses spectaculaires en mer.",meal:null},
  {id:"cafe_tab",n:"Caf√© du Port Tabarka",r:"nord_ouest",sub:"Tabarka",cat:"cafe",lt:36.95,lg:8.76,rt:4.0,dur:30,cost:7,hid:false,sn:["printemps","ete","automne"],cr:.15,d:"Caf√© face au fort, croissants frais.",meal:"breakfast"},
  {id:"resto_ain",n:"Chez Sa√Ød",r:"nord_ouest",sub:"A√Øn Draham",cat:"restaurant",lt:36.78,lg:8.68,rt:4.1,dur:60,cost:22,hid:true,sn:["printemps","ete","automne","hiver"],cr:.08,d:"Sanglier brais√©, cuisine de montagne.",meal:"dinner"},
  // NORD-EST ++
  {id:"lac_biz",n:"Lac de Bizerte",r:"nord_est",sub:"Bizerte",cat:"nature",lt:37.24,lg:9.86,rt:4.0,dur:45,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.20,d:"Promenade lac, pont mobile, p√™cheurs.",meal:null},
  {id:"medina_biz",n:"M√©dina Bizerte",r:"nord_est",sub:"Bizerte",cat:"attraction",lt:37.27,lg:9.87,rt:4.1,dur:50,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"Ruelles andalouses, mosqu√©es, zaou√Øas.",meal:null},
  // KAIROUAN ++
  {id:"k_tapis",n:"Atelier Tapis Kairouan",r:"centre",sub:"Kairouan",cat:"attraction",lt:35.68,lg:10.10,rt:4.2,dur:45,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"D√©monstration tissage, noeuds persans.",meal:null},
  {id:"k_makroudh",n:"P√¢tisserie El Amir",r:"centre",sub:"Kairouan",cat:"cafe",lt:35.68,lg:10.10,rt:4.3,dur:25,cost:4,hid:false,sn:["printemps","ete","automne","hiver"],cr:.50,d:"Meilleur makroudh de Tunisie.",meal:"breakfast"},
  {id:"k_resto",n:"Dar El Bey Kairouan",r:"centre",sub:"Kairouan",cat:"restaurant",lt:35.68,lg:10.10,rt:4.2,dur:65,cost:25,hid:true,sn:["printemps","ete","automne","hiver"],cr:.15,d:"Riad restaur√©, tagine agneau aux pruneaux.",meal:"dinner"},
  // SUD-OUEST ++
  {id:"medina_toz",n:"M√©dina Tozeur",r:"sud_ouest",sub:"Tozeur",cat:"attraction",lt:33.92,lg:8.13,rt:4.3,dur:50,cost:0,hid:false,sn:["automne","hiver","printemps"],cr:.20,d:"Briques Ouled Hadef, architecture unique.",meal:null},
  {id:"musee_dar",n:"Mus√©e Dar Chara√Øt",r:"sud_ouest",sub:"Tozeur",cat:"attraction",lt:33.92,lg:8.12,rt:4.1,dur:40,cost:7,hid:false,sn:["automne","hiver","printemps"],cr:.12,d:"Traditions oasiennes, costumes anciens.",meal:null},
  {id:"nefta_mosque",n:"Mosqu√©e Nefta",r:"sud_ouest",sub:"Nefta & Chebika",cat:"mosque",lt:33.87,lg:7.88,rt:4.0,dur:25,cost:0,hid:true,sn:["automne","hiver","printemps"],cr:.05,d:"Coupoles blanches au-dessus de la corbeille.",meal:null},
  // SUD-EST ++
  {id:"douz_souk",n:"Souk de Douz",r:"sud_ouest",sub:"Douz",cat:"attraction",lt:33.46,lg:8.83,rt:4.0,dur:40,cost:0,hid:false,sn:["automne","hiver"],cr:.20,d:"March√© du jeudi, dattes, artisanat nomade.",meal:null},
  {id:"ksar_ghilane",n:"Ksar Ghilane",r:"sud_ouest",sub:"Douz",cat:"nature",lt:33.49,lg:8.44,rt:4.5,dur:180,cost:50,hid:true,sn:["automne","hiver"],cr:.05,d:"Oasis saharienne, sources chaudes, bivouac.",meal:null},
  {id:"resto_tat",n:"Dar Tataouine",r:"sud_est",sub:"Tataouine",cat:"restaurant",lt:32.93,lg:10.45,rt:4.1,dur:60,cost:18,hid:true,sn:["automne","hiver","printemps"],cr:.05,d:"Cuisine berb√®re, brik dannouni.",meal:"lunch"},
  // DJERBA ++
  {id:"phare_dj",n:"Phare Taguermess",r:"djerba",sub:"Midoun",cat:"attraction",lt:33.84,lg:11.01,rt:4.0,dur:30,cost:0,hid:true,sn:["printemps","ete","automne","hiver"],cr:.10,d:"Plus ancien phare de Tunisie, panorama 360¬∞.",meal:null},
  {id:"lella_hadj",n:"Plage Lella Hadhria",r:"djerba",sub:"Midoun",cat:"beach",lt:33.80,lg:10.98,rt:4.3,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.30,d:"Longue plage de sable blanc, clubs.",meal:null},
  {id:"ajim",n:"Port Ajim",r:"djerba",sub:"Houmt Souk",cat:"attraction",lt:33.73,lg:10.75,rt:3.9,dur:35,cost:0,hid:true,sn:["printemps","ete","automne","hiver"],cr:.08,d:"Port cantina Star Wars, p√™che √©ponge.",meal:null},
  {id:"dar_dj2",n:"Restaurant Haroun",r:"djerba",sub:"Houmt Souk",cat:"restaurant",lt:33.88,lg:10.86,rt:4.3,dur:65,cost:28,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"Terrasse fondouk, couscous au poulpe.",meal:"dinner"},
  // SFAX ++
  {id:"sfax_olives",n:"Mus√©e de l'Olive Sfax",r:"sfax",sub:"Sfax Ville",cat:"attraction",lt:34.74,lg:10.75,rt:3.9,dur:35,cost:3,hid:true,sn:["printemps","automne","hiver"],cr:.08,d:"Histoire ol√©icole, pressoirs anciens.",meal:null},
  {id:"kerk_pl",n:"Plage Kerkennah",r:"sfax",sub:"Kerkennah",cat:"beach",lt:34.70,lg:11.18,rt:4.1,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.08,d:"Plage pr√©serv√©e, charfia p√™che ancestrale.",meal:null},
  {id:"resto_kerk",n:"Le P√™cheur Kerkennah",r:"sfax",sub:"Kerkennah",cat:"restaurant",lt:34.70,lg:11.17,rt:4.2,dur:60,cost:18,hid:true,sn:["printemps","ete","automne"],cr:.05,d:"Poisson du jour, octopus grill√©.",meal:"lunch"},
  // BEACH CLUBS
  {id:"ghar",n:"Ghar Melh Beach",r:"nord_est",sub:"Bizerte",cat:"beach",lt:37.17,lg:10.19,rt:4.4,dur:120,cost:15,hid:false,sn:["ete"],cr:.35,d:"Plage sauvage, lagune pr√©serv√©e.",meal:null},
  {id:"rafraf",n:"Rafraf Beach",r:"nord_est",sub:"Bizerte",cat:"beach",lt:37.19,lg:10.18,rt:4.5,dur:120,cost:0,hid:false,sn:["ete"],cr:.40,d:"Plus belle plage du Nord, eaux cristallines.",meal:null},
  {id:"capang",n:"Cap Angela",r:"nord_est",sub:"Bizerte",cat:"beach",lt:37.34,lg:9.75,rt:4.3,dur:90,cost:0,hid:true,sn:["ete","printemps"],cr:.08,d:"Point le plus au Nord d'Afrique.",meal:null},
  {id:"coco",n:"Coco Beach Bizerte",r:"nord_est",sub:"Bizerte",cat:"beach",lt:37.28,lg:9.88,rt:4.2,dur:120,cost:25,hid:false,sn:["ete"],cr:.50,d:"Beach club, ambiance festive.",meal:null},
  {id:"tabsus",n:"Tabsus Beach Club",r:"sahel",sub:"Mahdia",cat:"beach",lt:35.50,lg:11.06,rt:4.3,dur:120,cost:20,hid:false,sn:["ete"],cr:.30,d:"Beach club branch√© face mer.",meal:null},
  {id:"hamra",n:"El Hamra Beach",r:"sahel",sub:"Mahdia",cat:"beach",lt:35.52,lg:11.04,rt:4.1,dur:100,cost:10,hid:true,sn:["ete"],cr:.20,d:"Plage dor√©e, ambiance locale.",meal:null},
  {id:"pparis",n:"Petit Paris",r:"cap_bon",sub:"K√©libia",cat:"beach",lt:36.85,lg:11.10,rt:4.4,dur:120,cost:20,hid:false,sn:["ete"],cr:.35,d:"Beach club chic, DJ sets.",meal:null},
  {id:"mansoura",n:"Mansoura Beach",r:"cap_bon",sub:"K√©libia",cat:"beach",lt:36.83,lg:11.08,rt:4.5,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.25,d:"Eau turquoise, falaises impressionnantes.",meal:null},
  {id:"elbelge",n:"El Belge Beach",r:"cap_bon",sub:"K√©libia",cat:"beach",lt:36.84,lg:11.09,rt:4.2,dur:100,cost:10,hid:true,sn:["ete"],cr:.15,d:"Crique secr√®te, snorkeling.",meal:null},
  // 5-STAR HOTELS
  {id:"h_cigale",n:"La Cigale Tabarka",r:"nord_ouest",sub:"Tabarka",cat:"hotel",lt:36.96,lg:8.74,rt:4.7,dur:0,cost:350,hid:false,sn:["printemps","ete","automne","hiver"],cr:.20,d:"5‚òÖ Resort & spa, golf, plage priv√©e.",meal:null},
  {id:"h_marriott",n:"Tunis Marriott",r:"tunis",sub:"La Marsa & Gammarth",cat:"hotel",lt:36.90,lg:10.30,rt:4.6,dur:0,cost:380,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"5‚òÖ Vue mer Gammarth, spa, piscine.",meal:null},
  {id:"h_four",n:"Four Seasons Tunis",r:"tunis",sub:"La Marsa & Gammarth",cat:"hotel",lt:36.91,lg:10.29,rt:4.9,dur:0,cost:650,hid:false,sn:["printemps","ete","automne","hiver"],cr:.15,d:"5‚òÖ Luxe absolu, plage priv√©e, 3 restaurants.",meal:null},
  {id:"h_radisson",n:"Radisson Blu Hammamet",r:"cap_bon",sub:"Hammamet",cat:"hotel",lt:36.40,lg:10.60,rt:4.4,dur:0,cost:280,hid:false,sn:["printemps","ete","automne","hiver"],cr:.30,d:"5‚òÖ Face mer, thalasso, all inclusive.",meal:null},
  {id:"h_regency",n:"Regency Tunis",r:"tunis",sub:"La Marsa & Gammarth",cat:"hotel",lt:36.89,lg:10.30,rt:4.5,dur:0,cost:300,hid:false,sn:["printemps","ete","automne","hiver"],cr:.20,d:"5‚òÖ Gammarth, piscine panoramique.",meal:null},
  {id:"h_moven",n:"M√∂venpick Sousse",r:"sahel",sub:"Sousse",cat:"hotel",lt:35.84,lg:10.58,rt:4.5,dur:0,cost:320,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"5‚òÖ Resort, spa, parc aquatique.",meal:null},
  {id:"h_anant",n:"Anantara Tozeur",r:"sud_ouest",sub:"Tozeur",cat:"hotel",lt:33.93,lg:8.12,rt:4.8,dur:0,cost:500,hid:false,sn:["automne","hiver","printemps"],cr:.10,d:"5‚òÖ Luxe oasis, vue palmeraie et d√©sert.",meal:null},
  {id:"h_mouradi",n:"Mouradi Djerba",r:"djerba",sub:"Midoun",cat:"hotel",lt:33.79,lg:10.95,rt:4.3,dur:0,cost:250,hid:false,sn:["printemps","ete","automne","hiver"],cr:.35,d:"5‚òÖ Plage priv√©e, all inclusive.",meal:null},
  {id:"h_royal",n:"Royal Tulip Hammamet",r:"cap_bon",sub:"Hammamet",cat:"hotel",lt:36.41,lg:10.59,rt:4.4,dur:0,cost:260,hid:false,sn:["printemps","ete","automne","hiver"],cr:.20,d:"5‚òÖ Yasmine, thalasso, 4 piscines.",meal:null},

  // MORE SAHEL
  {id:"s_kantaoui_m",n:"Marina Kantaoui",r:"sahel",sub:"Sousse",cat:"attraction",lt:35.89,lg:10.60,rt:4.2,dur:60,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.55,d:"Marina luxe, bateaux, shopping bord de mer.",meal:null},
  {id:"s_remada",n:"Remada Palace",r:"sahel",sub:"Sousse",cat:"restaurant",lt:35.84,lg:10.63,rt:4.3,dur:70,cost:30,hid:false,sn:["printemps","ete","automne","hiver"],cr:.35,d:"Gastronomie tuniso-italienne, terrasse mer.",meal:"dinner"},
  {id:"s_mahdiafort",n:"Fort Mahdia",r:"sahel",sub:"Mahdia",cat:"attraction",lt:35.51,lg:11.07,rt:4.2,dur:40,cost:3,hid:false,sn:["printemps","automne","hiver"],cr:.20,d:"Phare et fortifications face M√©diterran√©e.",meal:null},
  {id:"s_eljem_mus",n:"Mus√©e El Jem",r:"centre",sub:"El Jem",cat:"attraction",lt:35.30,lg:10.71,rt:4.3,dur:40,cost:8,hid:true,sn:["printemps","automne","hiver"],cr:.30,d:"Mosa√Øques uniques, villas romaines.",meal:null},
  // MORE TUNIS
  {id:"t_tophet",n:"Tophet Carthage",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"attraction",lt:36.84,lg:10.32,rt:4.1,dur:35,cost:5,hid:true,sn:["printemps","automne","hiver"],cr:.25,d:"Sanctuaire punique, st√®les votives.",meal:null},
  {id:"t_palais",n:"Palais Ennejma Ezzahra",r:"tunis",sub:"Carthage & Sidi Bou Sa√Ød",cat:"attraction",lt:36.87,lg:10.34,rt:4.4,dur:50,cost:5,hid:true,sn:["printemps","ete","automne","hiver"],cr:.20,d:"Palais baron d'Erlanger, musique arabe.",meal:null},
  {id:"t_medina_r",n:"Resto Dar Slah",r:"tunis",sub:"Tunis Centre",cat:"restaurant",lt:36.80,lg:10.17,rt:4.3,dur:70,cost:28,hid:true,sn:["printemps","ete","automne","hiver"],cr:.15,d:"Kamounia, tajine, cuisine tunisoise authentique.",meal:"lunch"},
  {id:"t_tgm",n:"Balade TGM Banlieue",r:"tunis",sub:"La Marsa & Gammarth",cat:"nature",lt:36.88,lg:10.31,rt:4.0,dur:40,cost:1,hid:true,sn:["printemps","ete","automne"],cr:.20,d:"Train pittoresque longeant la mer.",meal:null},
  // MORE CAP BON
  {id:"cb_dar_chic",n:"Dar Chichone",r:"cap_bon",sub:"Nabeul",cat:"restaurant",lt:36.45,lg:10.73,rt:4.4,dur:70,cost:35,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"Gastronomie capbonnaise, brick tunisien.",meal:"dinner"},
  {id:"cb_plage_h",n:"Plage Hammamet",r:"cap_bon",sub:"Hammamet",cat:"beach",lt:36.40,lg:10.62,rt:4.3,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.60,d:"Plage mythique de sable dor√©.",meal:null},
  {id:"cb_medina_h",n:"M√©dina Hammamet",r:"cap_bon",sub:"Hammamet",cat:"attraction",lt:36.40,lg:10.61,rt:4.2,dur:50,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.55,d:"Petite m√©dina fortifi√©e face mer.",meal:null},
  {id:"cb_neapolis",n:"Neapolis Nabeul",r:"cap_bon",sub:"Nabeul",cat:"attraction",lt:36.46,lg:10.73,rt:4.0,dur:40,cost:5,hid:true,sn:["printemps","automne"],cr:.08,d:"Site arch√©o romain, garum et mosa√Øques.",meal:null},
  // MORE NORD-EST
  {id:"ne_lac_biz",n:"Lac de Bizerte",r:"nord_est",sub:"Bizerte",cat:"nature",lt:37.22,lg:9.85,rt:4.0,dur:50,cost:0,hid:false,sn:["printemps","ete","automne"],cr:.15,d:"Plus grand lac naturel, flamants.",meal:null},
  {id:"ne_plage_r",n:"Plage R√©mel",r:"nord_est",sub:"Bizerte",cat:"beach",lt:37.21,lg:10.15,rt:4.3,dur:100,cost:0,hid:true,sn:["ete"],cr:.12,d:"Plage sauvage au sable blanc dor√©.",meal:null},
  // MORE SUD
  {id:"se_ghomra",n:"Ghomrassen",r:"sud_est",sub:"Tataouine",cat:"attraction",lt:33.06,lg:10.34,rt:4.0,dur:40,cost:0,hid:true,sn:["automne","hiver","printemps"],cr:.03,d:"Village berb√®re, ksour en ruines.",meal:null},
  {id:"se_resto_d",n:"Caf√© D√©sert",r:"sud_ouest",sub:"Douz",cat:"restaurant",lt:33.46,lg:8.82,rt:4.1,dur:60,cost:18,hid:false,sn:["automne","hiver"],cr:.15,d:"Agneau m√©choui, sous tente b√©douine.",meal:"dinner"},
  {id:"sw_vieuxtozeur",n:"Vieux Tozeur Ouled Hadef",r:"sud_ouest",sub:"Tozeur",cat:"attraction",lt:33.92,lg:8.14,rt:4.3,dur:50,cost:0,hid:false,sn:["automne","hiver","printemps"],cr:.20,d:"Briques jaunes g√©om√©triques, ruelles.",meal:null},
  {id:"sw_lezard",n:"L√©zard Rouge Train",r:"sud_ouest",sub:"Tamerza",cat:"attraction",lt:34.35,lg:7.93,rt:4.4,dur:90,cost:15,hid:false,sn:["automne","hiver","printemps"],cr:.15,d:"Train historique gorges de Selja.",meal:null},
  // MORE DJERBA
  {id:"dj_plsidi",n:"Plage Sidi Mahrez",r:"djerba",sub:"Midoun",cat:"beach",lt:33.83,lg:10.98,rt:4.5,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.40,d:"Plus belle plage de Djerba, sable blanc.",meal:null},
  {id:"dj_lella",n:"Lella Hadhria Museum",r:"djerba",sub:"Midoun",cat:"attraction",lt:33.80,lg:10.93,rt:4.2,dur:50,cost:12,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"1000 pi√®ces art tunisien et arabe.",meal:null},
  {id:"dj_cafe_har",n:"Caf√© Haroun",r:"djerba",sub:"Houmt Souk",cat:"cafe",lt:33.87,lg:10.85,rt:4.3,dur:35,cost:7,hid:true,sn:["printemps","ete","automne","hiver"],cr:.20,d:"Vue port p√™cheurs, caf√© turc parfait.",meal:"breakfast"},
  // MORE KAIROUAN
  {id:"k_zaouia",n:"Zaouia Sidi Abid",r:"centre",sub:"Kairouan",cat:"mosque",lt:35.68,lg:10.10,rt:4.2,dur:25,cost:0,hid:true,sn:["printemps","automne","hiver"],cr:.15,d:"Zellige andalou, coupoles blanches.",meal:null},
  {id:"k_makroudh2",n:"P√¢tisserie Makroudh",r:"centre",sub:"Kairouan",cat:"restaurant",lt:35.68,lg:10.10,rt:4.3,dur:30,cost:5,hid:false,sn:["printemps","ete","automne","hiver"],cr:.40,d:"Meilleur makroudh de Tunisie, dattes Deglet.",meal:"breakfast"},
  {id:"h_bizerta",n:"Bizerta Resort",r:"nord_est",sub:"Bizerte",cat:"hotel",lt:37.27,lg:9.88,rt:4.3,dur:0,cost:220,hid:false,sn:["printemps","ete","automne","hiver"],cr:.20,d:"4‚òÖ Face vieux port, piscine, spa.",meal:null},
  {id:"h_capbon",n:"Hasdrubal Hammamet",r:"cap_bon",sub:"Hammamet",cat:"hotel",lt:36.40,lg:10.62,rt:4.6,dur:0,cost:400,hid:false,sn:["printemps","ete","automne","hiver"],cr:.20,d:"5‚òÖ Thalasso & Spa, plage priv√©e, 5 restos.",meal:null},
  {id:"h_cigale_m",n:"La Cigale Monastir",r:"sahel",sub:"Monastir",cat:"hotel",lt:35.77,lg:10.82,rt:4.5,dur:0,cost:300,hid:false,sn:["printemps","ete","automne","hiver"],cr:.25,d:"5‚òÖ Front de mer, golf, spa.",meal:null},
  // === ZAGHOUAN ===
  {id:"z_temple",n:"Temple des Eaux",r:"zaghouan",sub:"Zaghouan",cat:"attraction",lt:36.40,lg:10.14,rt:4.4,dur:50,cost:5,hid:false,sn:["printemps","automne","hiver"],cr:.15,d:"Temple romain d√©di√© aux nymphes, aqueduc.",meal:null},
  {id:"z_jbel",n:"Jbel Zaghouan",r:"zaghouan",sub:"Zaghouan",cat:"nature",lt:36.38,lg:10.12,rt:4.3,dur:120,cost:0,hid:true,sn:["printemps","automne"],cr:.08,d:"Randonn√©e 1295m, panorama sur le Cap Bon.",meal:null},
  {id:"z_medina",n:"M√©dina Zaghouan",r:"zaghouan",sub:"Zaghouan",cat:"attraction",lt:36.40,lg:10.14,rt:4.0,dur:40,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.15,d:"Ruelles blanches, artisanat, calme.",meal:null},
  {id:"z_thermes",n:"Thermes Jbel Oust",r:"zaghouan",sub:"Jbel Oust",cat:"nature",lt:36.46,lg:10.04,rt:4.1,dur:60,cost:15,hid:false,sn:["printemps","automne","hiver"],cr:.10,d:"Sources chaudes naturelles, spa ancestral.",meal:null},
  {id:"z_kayak",n:"Kayak Barrage Zaghouan",r:"zaghouan",sub:"Zaghouan",cat:"activity",lt:36.38,lg:10.10,rt:4.2,dur:90,cost:35,hid:false,sn:["printemps","ete","automne"],cr:.10,d:"Kayak sur lac de barrage, cadre montagneux.",meal:null},
  {id:"z_cafe",n:"Caf√© Ain El Jenna",r:"zaghouan",sub:"Zaghouan",cat:"cafe",lt:36.40,lg:10.14,rt:4.1,dur:30,cost:6,hid:false,sn:["printemps","ete","automne","hiver"],cr:.10,d:"Source fra√Æche, th√© sous les arbres.",meal:"breakfast"},
  {id:"z_resto",n:"Le Zaghouanais",r:"zaghouan",sub:"Zaghouan",cat:"restaurant",lt:36.40,lg:10.14,rt:4.0,dur:60,cost:20,hid:false,sn:["printemps","ete","automne","hiver"],cr:.10,d:"Cuisine montagnarde, agneau r√¥ti.",meal:"lunch"},
  // === NORD-OUEST EXPANDED: B√©ja, Makthar, Bou Salem ===
  {id:"nw_beja",n:"B√©ja Ville",r:"nord_ouest",sub:"B√©ja",cat:"attraction",lt:36.73,lg:9.18,rt:3.9,dur:50,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.05,d:"Grenier de Rome, architecture coloniale.",meal:null},
  {id:"nw_thibar",n:"Domaine Thibar",r:"nord_ouest",sub:"B√©ja",cat:"nature",lt:36.52,lg:9.10,rt:4.0,dur:60,cost:10,hid:true,sn:["printemps","automne"],cr:.03,d:"Vignobles coloniaux, d√©gustation vin tunisien.",meal:null},
  {id:"nw_makthar",n:"Ruines Makthar",r:"nord_ouest",sub:"B√©ja",cat:"attraction",lt:35.85,lg:9.20,rt:4.2,dur:70,cost:5,hid:true,sn:["printemps","automne"],cr:.03,d:"Arc Trajan, thermes romains, forum antique.",meal:null},
  // === ACTIVIT√âS TOURISTIQUES ===
  // Tozeur
  {id:"toz_quad",n:"Quad D√©sert Tozeur",r:"sud_ouest",sub:"Tozeur",cat:"activity",lt:33.90,lg:8.10,rt:4.5,dur:120,cost:80,hid:false,sn:["automne","hiver","printemps"],cr:.25,d:"Excursion quad dans les dunes, Chott el-J√©rid.",meal:null},
  {id:"toz_chameau",n:"Balade Chameau Douz",r:"sud_ouest",sub:"Douz",cat:"activity",lt:33.46,lg:8.82,rt:4.4,dur:90,cost:40,hid:false,sn:["automne","hiver"],cr:.30,d:"M√©har√©e au coucher du soleil dans le Grand Erg.",meal:null},
  {id:"toz_bivouac",n:"Bivouac Sahara",r:"sud_ouest",sub:"Douz",cat:"activity",lt:33.40,lg:8.80,rt:4.6,dur:180,cost:120,hid:true,sn:["automne","hiver"],cr:.05,d:"Nuit sous les √©toiles, repas b√©douin, feu de camp.",meal:null},
  // Mahdia
  {id:"mah_paddle",n:"Paddle Mahdia",r:"sahel",sub:"Mahdia",cat:"activity",lt:35.50,lg:11.06,rt:4.2,dur:60,cost:30,hid:false,sn:["ete","printemps"],cr:.20,d:"Stand-up paddle, eau cristalline face cap Afrique.",meal:null},
  // Monastir
  {id:"mon_plongee",n:"Plong√©e Monastir",r:"sahel",sub:"Monastir",cat:"activity",lt:35.78,lg:10.85,rt:4.3,dur:120,cost:80,hid:false,sn:["ete","printemps"],cr:.15,d:"Plong√©e √©pave, r√©cifs, poissons m√©diterran√©ens.",meal:null},
  // El Haouaria
  {id:"hao_plongee",n:"Plong√©e El Haouaria",r:"cap_bon",sub:"El Haouaria",cat:"activity",lt:37.06,lg:11.00,rt:4.5,dur:120,cost:80,hid:false,sn:["ete","printemps"],cr:.10,d:"Meilleur spot plong√©e Tunisie, grottes sous-marines.",meal:null},
  {id:"hao_bateau",n:"Excursion Zembra",r:"cap_bon",sub:"El Haouaria",cat:"activity",lt:37.06,lg:11.00,rt:4.6,dur:180,cost:100,hid:false,sn:["ete"],cr:.08,d:"Bateau vers √Æles Zembra & Zembretta, r√©serve naturelle.",meal:null},
  // Djerba
  {id:"dj_parachute",n:"Parachute Djerba",r:"djerba",sub:"Midoun",cat:"activity",lt:33.82,lg:10.98,rt:4.3,dur:30,cost:60,hid:false,sn:["ete","printemps"],cr:.25,d:"Parachute ascensionnel, vue √Æle depuis les airs.",meal:null},
  {id:"dj_cheval",n:"Balade Cheval Djerba",r:"djerba",sub:"Midoun",cat:"activity",lt:33.80,lg:10.95,rt:4.1,dur:60,cost:35,hid:false,sn:["printemps","ete","automne","hiver"],cr:.15,d:"Galop sur plage, coucher de soleil.",meal:null},
  // Sousse
  {id:"s_bled_arbi",n:"Bled Arbi Sousse",r:"sahel",sub:"Sousse",cat:"attraction",lt:35.82,lg:10.59,rt:4.0,dur:60,cost:0,hid:false,sn:["printemps","ete","automne","hiver"],cr:.20,d:"Quartier traditionnel, vie locale authentique.",meal:null},
  // Tabarka
  {id:"tab_plongee",n:"Plong√©e Tabarka",r:"nord_ouest",sub:"Tabarka",cat:"activity",lt:36.96,lg:8.75,rt:4.4,dur:120,cost:80,hid:false,sn:["ete","printemps"],cr:.15,d:"Corail rouge, m√©rous, fonds spectaculaires.",meal:null},
  // Bizerte
  {id:"biz_bateau",n:"Tour Bateau Bizerte",r:"nord_est",sub:"Bizerte",cat:"activity",lt:37.28,lg:9.87,rt:4.2,dur:90,cost:45,hid:false,sn:["ete","printemps"],cr:.20,d:"Tour du vieux port et lac, grottes c√¥ti√®res.",meal:null},
  // Hammamet
  {id:"ham_parachute",n:"Parachute Hammamet",r:"cap_bon",sub:"Hammamet",cat:"activity",lt:36.40,lg:10.62,rt:4.1,dur:30,cost:50,hid:false,sn:["ete","printemps"],cr:.30,d:"Vol en parachute ascensionnel sur le golfe.",meal:null},
  // === SUD-EST EXPANDED: Gab√®s, M√©denine, Zarzis ===
  {id:"se_gabes",n:"Oasis Gab√®s",r:"sud_est",sub:"Gab√®s",cat:"nature",lt:33.88,lg:10.10,rt:4.1,dur:70,cost:0,hid:false,sn:["automne","hiver","printemps"],cr:.10,d:"Unique oasis maritime au monde, palmeraie littorale.",meal:null},
  {id:"se_gabes_souk",n:"Souk Jara Gab√®s",r:"sud_est",sub:"Gab√®s",cat:"attraction",lt:33.88,lg:10.10,rt:4.0,dur:40,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.10,d:"Grand march√© traditionnel, henn√©, √©pices.",meal:null},
  {id:"se_medenine",n:"Ksour M√©denine",r:"sud_est",sub:"M√©denine & Zarzis",cat:"attraction",lt:33.35,lg:10.50,rt:4.2,dur:50,cost:3,hid:false,sn:["automne","hiver","printemps"],cr:.08,d:"Greniers vo√ªt√©s berb√®res, architecture spectaculaire.",meal:null},
  {id:"se_zarzis",n:"Plage Zarzis",r:"sud_est",sub:"M√©denine & Zarzis",cat:"beach",lt:33.50,lg:11.10,rt:4.3,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.10,d:"Sable blanc immacul√©, mer turquoise, calme.",meal:null},
  {id:"se_douiret",n:"Village Douiret",r:"sud_est",sub:"Tataouine",cat:"attraction",lt:32.87,lg:10.27,rt:4.4,dur:60,cost:0,hid:true,sn:["automne","hiver","printemps"],cr:.03,d:"Village troglodyte abandonn√©, vue √©poustouflante.",meal:null},
  {id:"se_cafe_gab",n:"Caf√© Oasis Gab√®s",r:"sud_est",sub:"Gab√®s",cat:"cafe",lt:33.88,lg:10.10,rt:4.0,dur:30,cost:5,hid:false,sn:["printemps","ete","automne","hiver"],cr:.08,d:"Th√© sous palmiers, frais de dattes.",meal:"breakfast"},
  {id:"se_resto_gab",n:"Le Palmier Gab√®s",r:"sud_est",sub:"Gab√®s",cat:"restaurant",lt:33.88,lg:10.10,rt:4.1,dur:60,cost:18,hid:false,sn:["printemps","ete","automne","hiver"],cr:.08,d:"Poisson charmoula, sp√©cialit√© gab√©sienne.",meal:"lunch"},

  // === MISSING NORD-OUEST: Bou Salem, Tajerouine ===
  {id:"nw_bousalem",n:"Bou Salem",r:"nord_ouest",sub:"Bou Salem",cat:"nature",lt:36.62,lg:8.97,rt:3.8,dur:40,cost:0,hid:true,sn:["printemps","automne"],cr:.03,d:"Vall√©e de la Medjerda, agriculture, calme rural.",meal:null},
  {id:"nw_tajerouine",n:"Tajerouine",r:"nord_ouest",sub:"Le Kef",cat:"attraction",lt:35.89,lg:8.55,rt:3.7,dur:40,cost:0,hid:true,sn:["printemps","automne"],cr:.02,d:"Petite ville historique, ruines romaines Ha√Ødra √† proximit√©.",meal:null},
  {id:"nw_haidra",n:"Ruines Ha√Ødra",r:"nord_ouest",sub:"Le Kef",cat:"attraction",lt:35.57,lg:8.46,rt:4.3,dur:80,cost:5,hid:true,sn:["printemps","automne"],cr:.02,d:"Site arch√©ologique majeur, arc de Septime S√©v√®re, basiliques.",meal:null},
  // === MISSING NORD-EST: Ghar El Melh, Raf Raf plage ===
  {id:"ne_ghar",n:"Ghar El Melh",r:"nord_est",sub:"Ghar El Melh",cat:"attraction",lt:37.17,lg:10.19,rt:4.1,dur:50,cost:0,hid:true,sn:["printemps","ete","automne"],cr:.05,d:"Port punique, forts ottomans, lagune pr√©serv√©e.",meal:null},
  {id:"ne_rafraf",n:"Plage Raf Raf",r:"nord_est",sub:"Raf Raf",cat:"beach",lt:37.19,lg:10.18,rt:4.4,dur:100,cost:0,hid:false,sn:["ete","printemps"],cr:.15,d:"Plus belle plage du Nord, sable fin, falaises.",meal:null},
  {id:"ne_cafe_raf",n:"Caf√© Sidi Ali El Mekki",r:"nord_est",sub:"Ghar El Melh",cat:"cafe",lt:37.18,lg:10.17,rt:4.0,dur:30,cost:5,hid:true,sn:["printemps","ete","automne"],cr:.05,d:"Vue lagune et montagne, th√© aux pignons.",meal:"breakfast"},
  // === MISSING CAP BON: Korba, Soliman ===
  {id:"cb_korba",n:"Lagune de Korba",r:"cap_bon",sub:"Korba",cat:"nature",lt:36.58,lg:10.86,rt:4.2,dur:50,cost:0,hid:false,sn:["printemps","automne","hiver"],cr:.10,d:"Zone humide Ramsar, flamants roses, oiseaux migrateurs.",meal:null},
  {id:"cb_korba_pl",n:"Plage Korba",r:"cap_bon",sub:"Korba",cat:"beach",lt:36.58,lg:10.87,rt:4.0,dur:80,cost:0,hid:false,sn:["ete","printemps"],cr:.15,d:"Longue plage sauvage, peu fr√©quent√©e.",meal:null},
  {id:"cb_soliman",n:"Soliman Plage",r:"cap_bon",sub:"Soliman",cat:"beach",lt:36.70,lg:10.52,rt:3.9,dur:80,cost:0,hid:false,sn:["ete","printemps"],cr:.20,d:"Plage familiale proche Tunis, restaurants poisson.",meal:null},
  {id:"cb_soliman_v",n:"March√© Soliman",r:"cap_bon",sub:"Soliman",cat:"attraction",lt:36.69,lg:10.49,rt:3.8,dur:40,cost:0,hid:true,sn:["printemps","ete","automne","hiver"],cr:.10,d:"Souk dominical anim√©, produits du Cap Bon.",meal:null},

];

var PROFILES={
  aventurier:{l:"Aventurier",i:"üßó",w:{attraction:1,nature:1.6,restaurant:.5,cafe:.4,hotel:.3,beach:.8,activity:1.2,mosque:.5}},
  culturel:{l:"Culturel",i:"üé≠",w:{attraction:1.5,nature:.5,restaurant:.9,cafe:1.2,hotel:.3,beach:.3,activity:.5,mosque:1.4}},
  nature_p:{l:"Nature",i:"üåø",w:{attraction:.5,nature:1.8,restaurant:.4,cafe:.6,hotel:.3,beach:1,activity:1,mosque:.2}},
  gourmand:{l:"Gourmand",i:"üçΩÔ∏è",w:{attraction:.6,nature:.4,restaurant:1.8,cafe:1.5,hotel:.5,beach:.6,activity:.6,mosque:.2}},
  photo:{l:"Photo",i:"üì∏",w:{attraction:1.3,nature:1.5,restaurant:.4,cafe:.8,hotel:.2,beach:.9,activity:.6,mosque:1}},
  detente:{l:"D√©tente",i:"üßò",w:{attraction:.3,nature:1.3,restaurant:1,cafe:1.3,hotel:1.5,beach:1.6,activity:.6,mosque:.2}},
  spirituel:{l:"Spirituel",i:"üïå",w:{attraction:1.2,nature:.8,restaurant:.4,cafe:.5,hotel:.3,beach:.1,activity:.6,mosque:1.8}},
  hotelier:{l:"H√¥tels 5‚òÖ",i:"üè®",w:{attraction:.5,nature:.3,restaurant:.8,cafe:.5,hotel:2,beach:.6,activity:.6,mosque:.2}}
};

var SEASONS={printemps:{l:"Printemps",i:"üå∏",s:"Mars - Mai"},ete:{l:"√ât√©",i:"‚òÄÔ∏è",s:"Juin - Ao√ªt"},automne:{l:"Automne",i:"üçÇ",s:"Sep - Nov"},hiver:{l:"Hiver",i:"‚ùÑÔ∏è",s:"D√©c - F√©v"}};

// Zone definitions for AI mode
var ZONES={
  all:{l:"Toute la Tunisie",i:"üáπüá≥",g:"top",regions:["tunis","sahel","djerba","cap_bon","sud_ouest","nord_ouest","sud_est","nord_est","centre","sfax","zaghouan"]},
  nord:{l:"Nord",i:"üèîÔ∏è",g:"top",regions:["tunis","nord_ouest","nord_est","cap_bon","zaghouan"]},
  centre_all:{l:"Centre & Sahel",i:"üèüÔ∏è",g:"top",regions:["centre","sahel","sfax"]},
  sud:{l:"Sud & √éles",i:"üèúÔ∏è",g:"top",regions:["sud_ouest","sud_est","djerba"]},
  tunis:{l:"Grand Tunis",i:"üèõÔ∏è",g:"reg",regions:["tunis"]},
  nord_ouest:{l:"Nord-Ouest",i:"üå≤",g:"reg",regions:["nord_ouest"]},
  nord_est:{l:"Nord-Est",i:"‚öì",g:"reg",regions:["nord_est"]},
  zaghouan:{l:"Zaghouan",i:"‚õ∞Ô∏è",g:"reg",regions:["zaghouan"]},
  cap_bon:{l:"Cap Bon",i:"üåä",g:"reg",regions:["cap_bon"]},
  sahel:{l:"Sahel",i:"üèüÔ∏è",g:"reg",regions:["sahel"]},
  centre:{l:"Kairouan & El Jem",i:"üïå",g:"reg",regions:["centre"]},
  sfax:{l:"Sfax & Kerkennah",i:"üêö",g:"reg",regions:["sfax"]},
  sud_ouest:{l:"Sud-Ouest",i:"üå¥",g:"reg",regions:["sud_ouest"]},
  sud_est:{l:"Sud-Est",i:"üèúÔ∏è",g:"reg",regions:["sud_est"]},
  djerba:{l:"Djerba",i:"üèùÔ∏è",g:"reg",regions:["djerba"]}
};

// Distance (km) between region centers - for geographic planning
var RDIST={};
(function(){
  REGIONS.forEach(function(a){REGIONS.forEach(function(b){
    var d=Math.sqrt(Math.pow((a.lt-b.lt)*111,2)+Math.pow((a.lg-b.lg)*90,2));
    RDIST[a.id+":"+b.id]=Math.round(d);
  })});
})();
function regDist(a,b){return RDIST[a+":"+b]||999}

function scoreAll(profs,comp){
  var mw={};profs.forEach(function(k){var w=PROFILES[k].w;Object.keys(w).forEach(function(t){mw[t]=(mw[t]||0)+w[t]})});
  Object.keys(mw).forEach(function(t){mw[t]/=(profs.length||1)});
  return PL.map(function(s){
    var sc=(mw[s.cat]||.5)*30+s.rt*10;if(s.hid)sc+=10;
    if(comp==="couple"&&(s.cat==="beach"||s.cat==="restaurant"))sc+=8;
    if(comp==="guide"&&(s.cat==="attraction"||s.cat==="mosque"))sc+=12;
    if(comp==="amis"&&s.cat==="beach")sc+=10;
    return Object.assign({},s,{sc:Math.round(Math.max(0,sc)*10)/10});
  }).sort(function(a,b){return b.sc-a.sc});
}

// Haversine-like distance in km between two spots
function spotDist(a,b){
  if(!a||!b||!a.lt||!b.lt)return 999;
  return Math.sqrt(Math.pow((a.lt-b.lt)*111,2)+Math.pow((b.lg-a.lg)*90*Math.cos(a.lt*Math.PI/180),2));
}

function aiPlan(profs,comp,nD,wBk,wLu,wDi,zones){
  var MAX_D=40; // 40km max entre spots
  var all=scoreAll(profs,comp);
  // Merge regions from all selected zones (deduplicated)
  var zArr=Array.isArray(zones)?zones:zones?[zones]:["all"];
  var zoneRegs=[];
  zArr.forEach(function(zk){
    var zDef=ZONES[zk]||ZONES.all;
    zDef.regions.forEach(function(r){if(zoneRegs.indexOf(r)<0)zoneRegs.push(r)});
  });
  // Filter by merged regions
  var pool=all.filter(function(s){return zoneRegs.indexOf(s.r)>=0});
  var acts=pool.filter(function(s){return!s.meal&&s.cat!=="hotel"});
  var bkfs=pool.filter(function(s){return s.meal==="breakfast"});
  var luns=pool.filter(function(s){return s.meal==="lunch"});
  var dins=pool.filter(function(s){return s.meal==="dinner"});
  var hotels=pool.filter(function(s){return s.cat==="hotel"});
  // Shuffle top acts for variety (keep scoring but randomize within tiers)
  var tier1=acts.slice(0,Math.ceil(acts.length*.4));
  var tier2=acts.slice(Math.ceil(acts.length*.4));
  for(var ti=tier1.length-1;ti>0;ti--){var tj=Math.floor(Math.random()*(ti+1));var tt=tier1[ti];tier1[ti]=tier1[tj];tier1[tj]=tt}
  acts=tier1.concat(tier2);
  // Used tracker - NEVER reset, each spot used only once across all days
  var used={};
  var usedMeals={};
  var days=[];
  for(var d=0;d<nD;d++){
    // Pick seed: highest scoring unused activity
    var seed=null;
    for(var si=0;si<acts.length;si++){
      if(!used[acts[si].id]){seed=acts[si];used[acts[si].id]=true;break}
    }
    if(!seed)break; // No more unused spots - stop adding days
    // Build cluster: find nearby spots within MAX_D km of seed
    var cluster=[seed];
    var center={lt:seed.lt,lg:seed.lg};
    var beachUsed=seed.cat==="beach";
    // Candidates: sorted by distance to seed, ONLY unused
    var cands=acts.filter(function(s){return!used[s.id]});
    cands.sort(function(a,b){return spotDist(a,center)-spotDist(b,center)});
    for(var ci=0;ci<cands.length&&cluster.length<5;ci++){
      // Check max distance to ALL spots already in cluster
      var tooFar=false;
      for(var ck=0;ck<cluster.length;ck++){
        if(spotDist(cands[ci],cluster[ck])>MAX_D){tooFar=true;break}
      }
      if(tooFar)continue;
      if(cands[ci].cat==="beach"){if(beachUsed)continue;beachUsed=true}
      cluster.push(cands[ci]);
      used[cands[ci].id]=true;
    }
    // Sort cluster by nearest-neighbor path
    var ordered=[cluster[0]];var rem=cluster.slice(1);
    while(rem.length){
      var last=ordered[ordered.length-1];
      var best=-1,bestD=Infinity;
      for(var ri=0;ri<rem.length;ri++){
        var dd=spotDist(last,rem[ri]);
        if(dd<bestD){bestD=dd;best=ri}
      }
      ordered.push(rem[best]);rem.splice(best,1);
    }
    // Determine region of majority spots
    var regCount={};
    ordered.forEach(function(s){regCount[s.r]=(regCount[s.r]||0)+1});
    var rid=Object.keys(regCount).sort(function(a,b){return regCount[b]-regCount[a]})[0];
    // Build timeline with meals
    var spots=[];var cm=0;
    // Breakfast: find one near cluster center, not already used
    if(wBk){
      var bkC=bkfs.filter(function(s){return!usedMeals[s.id]&&spotDist(s,center)<MAX_D});
      if(!bkC.length)bkC=bkfs.filter(function(s){return!usedMeals[s.id]});
      if(!bkC.length)bkC=bkfs;
      var bk=bkC[0];
      if(bk){usedMeals[bk.id]=true;spots.push(Object.assign({},bk,{stM:cm,alM:40,tv:0,_ml:"breakfast"}));cm+=55}
    }
    var nAct=ordered.length;
    for(var a=0;a<nAct;a++){
      var sp=ordered[a];
      spots.push(Object.assign({},sp,{stM:cm,alM:Math.min(sp.dur||60,80),tv:12}));
      cm+=Math.min(sp.dur||60,80)+12;
      // Lunch after half
      if(wLu&&a===Math.floor(nAct/2)-1){
        var lnC=luns.filter(function(s){return!usedMeals[s.id]&&spotDist(s,center)<MAX_D});
        if(!lnC.length)lnC=luns.filter(function(s){return!usedMeals[s.id]});
        if(!lnC.length)lnC=luns;
        var ln=lnC[0];
        if(ln){usedMeals[ln.id]=true;spots.push(Object.assign({},ln,{stM:cm,alM:60,tv:10,_ml:"lunch"}));cm+=70}
      }
    }
    // Dinner
    if(wDi){
      var dnC=dins.filter(function(s){return!usedMeals[s.id]&&spotDist(s,center)<MAX_D});
      if(!dnC.length)dnC=dins.filter(function(s){return!usedMeals[s.id]});
      if(!dnC.length)dnC=dins;
      var dn=dnC[0];
      if(dn){usedMeals[dn.id]=true;spots.push(Object.assign({},dn,{stM:cm,alM:75,tv:10,_ml:"dinner"}));cm+=85}
    }
    // Hotel
    var wHo=profs.indexOf("hotelier")>=0;
    if(wHo){
      var htC=hotels.filter(function(s){return spotDist(s,center)<MAX_D});
      if(!htC.length)htC=hotels;
      var ht=htC.length?htC[d%htC.length]:null;
      if(ht){spots.push(Object.assign({},ht,{stM:cm,alM:0,tv:10,_ht:true}));cm+=10}
    }
    days.push({rid:rid,spots:spots});
  }
  return days;
}

function scorePL(rids,profs,comp,sea,avC,iH){
  var mw={};profs.forEach(function(k){var w=PROFILES[k].w;Object.keys(w).forEach(function(t){mw[t]=(mw[t]||0)+w[t]})});
  Object.keys(mw).forEach(function(t){mw[t]/=(profs.length||1)});
  var ridArr=Array.isArray(rids)?rids:[rids];
  return PL.filter(function(p){return ridArr.indexOf(p.r)>=0}).map(function(s){
    var sc=(mw[s.cat]||.5)*30+s.rt*10;if(s.hid&&iH)sc+=12;if(s.hid&&!iH)sc-=10;
    if(sea&&s.sn&&s.sn.indexOf(sea)>=0)sc+=15;else if(sea)sc-=20;
    if(avC)sc-=Math.min(1,s.cr||0)*20;
    if(comp==="couple"&&(s.cat==="beach"||s.cat==="restaurant"))sc+=8;
    if(comp==="guide"&&(s.cat==="attraction"||s.cat==="mosque"))sc+=12;
    return Object.assign({},s,{sc:Math.round(Math.max(0,sc)*10)/10});
  }).sort(function(a,b){return b.sc-a.sc});
}

// Leaflet Interactive Map
function LeafletMap(props){
  var containerRef=useRef(null);
  var mapRef=useRef(null);
  var lt=props.lt||34.5,lg=props.lg||9.5,z=props.z||7,h=props.h||220;
  var spots=props.spots||[];var rid=props.activeRid;
  var spotsKey=spots.map(function(s){return s.id||s.n}).join(",");

  useEffect(function(){
    if(!document.getElementById("leaflet-css")){
      var link=document.createElement("link");link.id="leaflet-css";link.rel="stylesheet";
      link.href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css";
      document.head.appendChild(link);
    }
    function initMap(){
      if(!containerRef.current||!window.L)return;
      if(mapRef.current){mapRef.current.remove();mapRef.current=null}
      var map=window.L.map(containerRef.current,{zoomControl:true,attributionControl:false}).setView([lt,lg],z);
      window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:18}).addTo(map);
      var colors=["#c17f3e","#1a6985","#27ae60","#c0392b","#8b5cf6","#e67e22","#16a085","#2c3e50"];
      var bounds=[];
      spots.forEach(function(s,i){
        var isMeal=!!s._ml;var isHotel=!!s._ht;
        var mCol=isMeal?"#e67e22":isHotel?"#8b5cf6":colors[i%8];
        var mIcon=isMeal?"üçΩ":isHotel?"üè®":(i+1);
        var icon=window.L.divIcon({className:"",html:'<div style="width:24px;height:24px;border-radius:50%;background:'+mCol+';color:#fff;font-size:10px;font-weight:800;display:flex;align-items:center;justify-content:center;border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,.3)">'+mIcon+"</div>",iconSize:[24,24],iconAnchor:[12,12]});
        window.L.marker([s.lt,s.lg],{icon:icon}).addTo(map).bindPopup("<b>"+s.n+"</b><br>"+((s.d||"").substring(0,60)));
        bounds.push([s.lt,s.lg]);
      });
      if(bounds.length>1)map.fitBounds(bounds,{padding:[30,30]});
      else if(bounds.length===1)map.setView(bounds[0],13);
      mapRef.current=map;
      setTimeout(function(){map.invalidateSize()},200);
    }
    if(window.L){initMap()}
    else{
      if(!document.getElementById("leaflet-js")){
        var script=document.createElement("script");script.id="leaflet-js";
        script.src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js";
        script.onload=initMap;document.head.appendChild(script);
      }else{var check=setInterval(function(){if(window.L){clearInterval(check);initMap()}},100)}
    }
    return function(){if(mapRef.current){mapRef.current.remove();mapRef.current=null}};
  },[lt,lg,z,spotsKey,rid]);

  return <div ref={containerRef} style={{width:"100%",height:h,borderRadius:14,border:"2px solid "+TN.bd,overflow:"hidden",zIndex:1}}/>;
}

export default function App(){
  var _u=useState(null),user=_u[0],setUser=_u[1];
  var _am=useState("login"),aMode=_am[0],setAMode=_am[1];
  var _an=useState(""),aN=_an[0],setAN=_an[1];
  var _ae=useState(""),aE=_ae[0],setAE=_ae[1];
  var _ap=useState(""),aP=_ap[0],setAP=_ap[1];
  var _aerr=useState(""),aErr=_aerr[0],setAErr=_aerr[1];
  var _udb=useState({}),uDB=_udb[0],setUDB=_udb[1];
  var _vw=useState("home"),vw=_vw[0],setVw=_vw[1];
  var _regs=useState(["tunis"]),regs=_regs[0],setRegs=_regs[1];
  var _profs=useState([]),profs=_profs[0],setProfs=_profs[1];
  var _comp=useState("couple"),comp=_comp[0],setComp=_comp[1];
  var _nD=useState(3),nD=_nD[0],setND=_nD[1];
  var _zone=useState(["all"]),zones=_zone[0],setZones=_zone[1];
  var _bud=useState(500),bud=_bud[0],setBud=_bud[1];
  var _wBk=useState(false),wBk=_wBk[0],setWBk=_wBk[1];
  var _wLu=useState(false),wLu=_wLu[0],setWLu=_wLu[1];
  var _wDi=useState(false),wDi=_wDi[0],setWDi=_wDi[1];
  var _sea=useState("printemps"),sea=_sea[0],setSea=_sea[1];
  var _sH=useState(9),sH=_sH[0],setSH=_sH[1];
  var _avC=useState(true),avC=_avC[0],setAvC=_avC[1];
  var _iH=useState(true),iH=_iH[0],setIH=_iH[1];
  var _scored=useState([]),scored=_scored[0],setScored=_scored[1];
  var _sel=useState(new Set()),sel=_sel[0],setSel=_sel[1];
  var _catF=useState("all"),catF=_catF[0],setCatF=_catF[1];
  var _itin=useState(null),itin=_itin[0],setItin=_itin[1];
  var _aD=useState(0),aD=_aD[0],setAD=_aD[1];
  var _trips=useState([]),trips=_trips[0],setTrips=_trips[1];
  var _aT=useState(null),aT=_aT[0],setAT=_aT[1];
  var _gP=useState(0),gP=_gP[0],setGP=_gP[1];
  var _gT=useState(""),gT=_gT[0],setGT=_gT[1];

  var rObj=REGIONS.find(function(r){return r.id===regs[0]});
  var rc=function(r){if(Array.isArray(r))return PL.filter(function(p){return r.indexOf(p.r)>=0}).length;return PL.filter(function(p){return p.r===r}).length};
  var cats=Array.from(new Set(PL.filter(function(p){return regs.indexOf(p.r)>=0}).map(function(p){return p.cat})));
  var togP=function(k){setProfs(function(p){return p.indexOf(k)>=0?p.filter(function(x){return x!==k}):p.concat([k])})};
  var togS=function(id){setSel(function(p){var n=new Set(p);n.has(id)?n.delete(id):n.add(id);return n})};
  var doAuth=function(){
    if(aMode==="signup"){if(!aN||!aE||!aP){setAErr("Tous les champs requis");return}var db=Object.assign({},uDB);db[aE]={nm:aN,em:aE,pw:aP};setUDB(db);setUser({nm:aN,em:aE})}
    else{var u=uDB[aE];if(!u||u.pw!==aP){setAErr("Identifiants incorrects");return}setUser({nm:u.nm,em:u.em})}setAErr("")};

  var aiGo=function(){
    if(!profs.length)return;setVw("ai_load");setGP(0);
    var steps=[{p:10,t:"Analyse des preferences..."},{p:28,t:"Selection des regions..."},{p:45,t:"Meilleurs spots par region..."},{p:60,t:"Restaurants & cafes..."},{p:78,t:"Petit-dej, Dejeuner, Diner..."},{p:92,t:"Repartition "+nD+" jours..."},{p:100,t:"Votre voyage est pret!"}];
    steps.forEach(function(s,i){setTimeout(function(){setGP(s.p);setGT(s.t)},250+i*400)});
    setTimeout(function(){
      var plan=aiPlan(profs,comp,nD,wBk,wLu,wDi,zones);
      var allS=[];plan.forEach(function(d){d.spots.forEach(function(s){allS.push(s)})});
      setItin({days:plan,stats:{total:allS.filter(function(s){return!s._ml&&!s._ht}).length,meals:allS.filter(function(s){return!!s._ml}).length,hotels:allS.filter(function(s){return!!s._ht}).length,cost:allS.reduce(function(a,s){return a+s.cost},0),days:nD},all:allS});
      setVw("ai_result");setAD(0);
    },250+7*400+350);
  };

  var manGo=function(){var s=scorePL(regs,profs,comp,sea,avC,iH);setScored(s);setSel(new Set());setCatF("all");setVw("man_sel")};
  var manBuild=function(){
    if(!sel.size)return;setVw("man_load");setGP(0);
    setTimeout(function(){setGP(30);setGT("Calcul des distances...")},200);
    setTimeout(function(){setGP(60);setGT("Regroupement geographique...")},500);
    setTimeout(function(){setGP(90);setGT("Optimisation itineraire...")},800);
    setTimeout(function(){setGP(100);setGT("Pret!")},1000);
    setTimeout(function(){
      var chosen=scored.filter(function(s){return sel.has(s.id)});
      // Haversine-like distance in km
      function distKm(a,b){var dLt=(a.lt-b.lt)*111;var dLg=(a.lg-b.lg)*90;return Math.sqrt(dLt*dLt+dLg*dLg)}
      // Group spots into geographic clusters (max ~40km / ~30min within cluster)
      var used=new Array(chosen.length).fill(false);
      var clusters=[];
      // Sort by latitude (north to south) then longitude for consistent ordering
      var sorted=chosen.map(function(s,i){return{idx:i,s:s}}).sort(function(a,b){return b.s.lt-a.s.lt||(a.s.lg-b.s.lg)});
      for(var i=0;i<sorted.length;i++){
        if(used[sorted[i].idx])continue;
        var cluster=[sorted[i].s];used[sorted[i].idx]=true;
        var center={lt:sorted[i].s.lt,lg:sorted[i].s.lg};
        // Find nearby spots within 40km (~30min)
        for(var j=i+1;j<sorted.length;j++){
          if(used[sorted[j].idx])continue;
          var d=distKm(center,sorted[j].s);
          if(d<=40){
            cluster.push(sorted[j].s);used[sorted[j].idx]=true;
            center={lt:(center.lt+sorted[j].s.lt)/2,lg:(center.lg+sorted[j].s.lg)/2};
          }
        }
        clusters.push(cluster);
      }
      // Within each cluster: nearest-neighbor route (no back-and-forth)
      function optimizeRoute(spots){
        if(spots.length<=1)return spots;
        var remaining=spots.slice();var route=[remaining.shift()];
        while(remaining.length){
          var last=route[route.length-1];var bestIdx=0;var bestDist=999;
          for(var r=0;r<remaining.length;r++){
            var dd=distKm(last,remaining[r]);
            if(dd<bestDist){bestDist=dd;bestIdx=r}
          }
          route.push(remaining.splice(bestIdx,1)[0]);
        }
        return route;
      }
      clusters=clusters.map(optimizeRoute);
      // Distribute clusters across days
      var days=[];
      if(clusters.length<=nD){
        // Each cluster gets its own day(s)
        for(var c=0;c<clusters.length;c++){var cReg=clusters[c][0]?.r||regs[0];days.push({rid:cReg,spots:clusters[c]})}
        // Fill remaining days if needed
        while(days.length<nD&&days.length<chosen.length){
          var biggest=0;
          for(var bb=1;bb<days.length;bb++){if(days[bb].spots.length>days[biggest].spots.length)biggest=bb}
          if(days[biggest].spots.length<=1)break;
          var half=Math.ceil(days[biggest].spots.length/2);
          var split=days[biggest].spots.splice(half);
          days.push({rid:days[biggest]?.rid||regs[0],spots:split});
        }
      }else{
        // More clusters than days: merge closest clusters
        while(clusters.length>nD){
          var minD=9999;var mi=-1;var mj=-1;
          for(var a=0;a<clusters.length;a++){for(var b=a+1;b<clusters.length;b++){
            var cA=clusters[a][0];var cB=clusters[b][0];var dd=distKm(cA,cB);
            if(dd<minD){minD=dd;mi=a;mj=b}
          }}
          clusters[mi]=optimizeRoute(clusters[mi].concat(clusters[mj]));
          clusters.splice(mj,1);
        }
        for(var c=0;c<clusters.length;c++){var cReg=clusters[c][0]?.r||regs[0];days.push({rid:cReg,spots:clusters[c]})}
      }
      // Cap at max 5 spots per day, split overflow
      var capped=[];
      days.forEach(function(day){
        if(day.spots.length<=5){capped.push(day)}
        else{
          for(var ci=0;ci<day.spots.length;ci+=5){
            capped.push({rid:day.rid,spots:day.spots.slice(ci,ci+5)});
          }
        }
      });
      days=capped;
      // Max 1 beach per day ‚Äî move excess beaches to other days or remove
      days.forEach(function(day){
        var bCount=0;
        day.spots=day.spots.filter(function(s){
          if(s.cat==="beach"){bCount++;return bCount<=1}
          return true;
        });
      });
      // Add timing to each day's spots
      days=days.map(function(day){
        var cm=0;
        return{rid:day.rid,spots:day.spots.map(function(s,j){
          var tv=j>0?15:0;var du=Math.min(s.dur||60,120);
          var r=Object.assign({},s,{stM:cm,alM:du,tv:tv});cm+=du+tv;return r;
        })};
      });
      var cost=chosen.reduce(function(a,s){return a+s.cost},0);
      setItin({days:days,stats:{total:chosen.length,meals:0,cost:cost,days:days.length},all:chosen});
      setND(days.length);setVw("man_result");setAD(0);
    },1200);
  };

  var saveTrip=function(){
    if(!itin)return;var rIcons=itin.days.map(function(d){return REGIONS.find(function(x){return x.id===d.rid})?.icon||""}).join("");
    setTrips(function(p){return[{id:Date.now(),nm:rIcons+" "+nD+"j",dy:nD,sp:itin.stats.total,it:itin,dt:new Date().toLocaleDateString()}].concat(p)});setVw("trips");
  };

  var cs={background:TN.card,borderRadius:20,padding:24,border:"1px solid "+TN.bd,boxShadow:TN.shadow,transition:"all 0.3s ease"};
  var ls={fontSize:11,fontWeight:700,color:TN.tM,textTransform:"uppercase",letterSpacing:1.2,marginBottom:10,fontFamily:F};
  var btn={padding:"16px 24px",borderRadius:12,border:"none",fontSize:15,fontWeight:600,fontFamily:F,cursor:"pointer",color:"#fff",background:"linear-gradient(135deg,"+TN.pr+" 0%, "+TN.pD+" 100%)",boxShadow:TN.shadowMd,width:"100%",transition:"all 0.3s ease",transform:"translateY(0)"};
  var back=function(fn){return <button onClick={fn} style={{fontSize:13,color:TN.pr,background:"none",border:"none",cursor:"pointer",fontWeight:600,marginBottom:12,display:"flex",alignItems:"center",gap:4,transition:"all 0.2s ease"}}>‚Üê Retour</button>};
  var LoadUI=<div style={Object.assign({},cs,{textAlign:"center",marginTop:32,padding:40})}><div style={{width:72,height:72,borderRadius:"50%",background:"linear-gradient(135deg,"+TN.pr+" 0%, "+TN.pD+" 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:700,color:'#fff',margin:"0 auto 20px",boxShadow:TN.shadowMd}}>AI</div><div style={{fontSize:18,fontWeight:600,fontFamily:F,color:TN.tx,marginBottom:4}}>{gT||"Chargement..."}</div><div style={{height:8,borderRadius:12,background:TN.sand,overflow:"hidden",marginTop:20,border:"1px solid "+TN.bd}}><div style={{height:"100%",borderRadius:12,width:gP+"%",background:"linear-gradient(90deg,"+TN.pr+" 0%, "+TN.ac+" 100%)",transition:"width 0.4s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 0 8px "+TN.pr+"40"}}/></div></div>;
  var colors=["#c17f3e","#1a6985","#27ae60","#c0392b","#8b5cf6","#e67e22","#16a085","#2c3e50"];

  var DayView=function(props){
    var day=props.day,di=props.di,dayR=REGIONS.find(function(r){return r.id===day.rid});
    return <div style={cs}>
      <div style={{display:"flex",alignItems:"center",gap:10,marginBottom:20}}>
        <div style={{fontSize:24,fontWeight:700,fontFamily:F,color:TN.tx}}>Jour {di+1}</div>
        {dayR&&<span style={{fontSize:12,fontWeight:600,background:"linear-gradient(135deg, "+TN.sand+" 0%, #ffe8cc 100%)",color:TN.pD,borderRadius:24,padding:"6px 16px",border:"1px solid "+TN.sD,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"}}>{dayR.icon} {dayR.name}</span>}
        <span style={{fontSize:11,color:TN.tM,marginLeft:"auto",fontWeight:500}}>{day.spots.filter(function(s){return!s._ml}).length} spots</span>
      </div>
      {day.spots.map(function(site,i){
        var h=sH+Math.floor(site.stM/60),m=site.stM%60;var isMeal=!!site._ml;var isHotel=!!site._ht;
        var bgCol=isMeal?"#fef9f0":isHotel?"#f0e6ff":"transparent";
        var circCol=isMeal?"#e67e22":isHotel?"#8b5cf6":colors[i%8];
        var circIcon=isMeal?"üçΩ":isHotel?"üè®":(i+1);
        return <div key={site.id+"-"+i} style={{display:"flex",gap:14,alignItems:"flex-start",marginBottom:i<day.spots.length-1?16:0,paddingBottom:i<day.spots.length-1?16:0,borderBottom:i<day.spots.length-1?"1px solid "+TN.bd:"none"}}>
          <div style={{display:"flex",flexDirection:"column",alignItems:"center",width:48,flexShrink:0}}>
            <div style={{fontSize:11,fontWeight:600,color:circCol,fontFamily:F}}>{isHotel?"Nuit":h+":"+(m<10?"0"+m:m)}</div>
            <div style={{width:28,height:28,borderRadius:"50%",background:circCol,color:"#fff",fontSize:isMeal||isHotel?12:11,fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center",marginTop:4,border:"3px solid #fff",boxShadow:TN.shadowMd}}>{circIcon}</div>
            {i<day.spots.length-1&&<div style={{width:2,height:20,background:"linear-gradient(180deg, "+circCol+" 0%, "+TN.bd+" 100%)",marginTop:4,borderRadius:1}}/>}
          </div>
          <div style={{flex:1,background:bgCol,borderRadius:(isMeal||isHotel)?16:0,padding:(isMeal||isHotel)?"14px 16px":"0",border:(isMeal||isHotel)?"1px solid "+(isMeal?"#ffe8cc":"#e9d5ff"):"none"}}>
            <div style={{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap"}}>
              {isMeal&&<span style={{fontSize:10,fontWeight:600,color:"#d97706",background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 100%)",borderRadius:8,padding:"4px 10px",border:"1px solid #fbbf24"}}>{ML[site._ml]}</span>}
              {isHotel&&<span style={{fontSize:10,fontWeight:600,color:"#7c3aed",background:"linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%)",borderRadius:8,padding:"4px 10px",border:"1px solid #c084fc"}}>üè® H√©bergement 5‚òÖ</span>}
              <span style={{fontSize:15,fontWeight:600,fontFamily:F,color:TN.tx}}>{site.n}</span>
              <span style={{fontSize:14}}>{CATS[site.cat]?.i}</span>
            </div>
            <div style={{fontSize:11,color:TN.tM,marginTop:6,lineHeight:1.6}}>{site.d}</div>
            <div style={{display:"flex",gap:10,marginTop:8,fontSize:10,color:TN.tM,fontWeight:500}}>{!isHotel&&<span style={{background:TN.sand,padding:"4px 10px",borderRadius:8,border:"1px solid #ffe8cc"}}>‚è± {site.alM}min</span>}<span style={{background:site.cost?TN.aL:TN.sand+"80",padding:"4px 10px",borderRadius:8,border:"1px solid "+(site.cost?"#90caf9":"#e0e0e0")}}>{site.cost?site.cost+"TND":"Gratuit"}</span><span style={{background:"linear-gradient(135deg, #fff9c4 0%, #ffeb3b30 100%)",padding:"4px 10px",borderRadius:8,border:"1px solid #fdd835"}}>‚≠ê {site.rt}</span>{i>0&&day.spots[i-1]&&site.lt&&day.spots[i-1].lt?<span style={{background:TN.card,padding:"4px 10px",borderRadius:8,border:"1px solid "+TN.bd}}>üöó {Math.round(Math.sqrt(Math.pow((site.lt-day.spots[i-1].lt)*111,2)+Math.pow((site.lg-day.spots[i-1].lg)*90,2)))}km</span>:null}</div>
          </div>
        </div>})}
    </div>;
  };

  // AUTH
  if(!user)return(
    <div style={{minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:F2,color:"#fff"}}>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
      <div style={{width:"100%",maxWidth:440,padding:32}}>
        <div style={{background:"rgba(255,255,255,0.98)",borderRadius:24,padding:"48px 40px",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",backdropFilter:"blur(10px)"}}>
          <div style={{textAlign:"center",marginBottom:32}}><Logo size={72}/><h1 style={{fontSize:32,fontWeight:700,fontFamily:F,color:TN.tx,margin:"12px 0 4px",letterSpacing:"-0.5px"}}>TUN Trip</h1><p style={{fontSize:14,color:TN.tM,fontFamily:F}}>D√©couvrez les perles de la Tunisie</p></div>
          <div style={{display:"flex",marginBottom:24,background:TN.sand,borderRadius:14,padding:4}}>
            {["login","signup"].map(function(m){return <button key={m} onClick={function(){setAMode(m);setAErr("")}} style={{flex:1,padding:"12px 20px",border:"none",cursor:"pointer",fontSize:14,fontWeight:600,fontFamily:F2,background:aMode===m?"#fff":"transparent",color:aMode===m?TN.tx:TN.tM,borderRadius:12,boxShadow:aMode===m?TN.shadow:"none",transition:"all 0.3s ease"}}>{m==="login"?"Connexion":"Inscription"}</button>})}
          </div>
          <div style={{display:"flex",flexDirection:"column",gap:14}}>
            {aMode==="signup"&&<input value={aN} onChange={function(e){setAN(e.target.value)}} placeholder="Votre nom" style={{padding:"16px 18px",borderRadius:14,border:"2px solid "+TN.bd,background:TN.bg,color:TN.tx,fontSize:15,fontFamily:F2,outline:"none",transition:"all 0.3s ease"}}/>}
            <input value={aE} onChange={function(e){setAE(e.target.value)}} placeholder="Email" style={{padding:"16px 18px",borderRadius:14,border:"2px solid "+TN.bd,background:TN.bg,color:TN.tx,fontSize:15,fontFamily:F2,outline:"none",transition:"all 0.3s ease"}}/>
            <input value={aP} onChange={function(e){setAP(e.target.value)}} placeholder="Mot de passe" type="password" style={{padding:"16px 18px",borderRadius:14,border:"2px solid "+TN.bd,background:TN.bg,color:TN.tx,fontSize:15,fontFamily:F2,outline:"none",transition:"all 0.3s ease"}} onKeyDown={function(e){if(e.key==="Enter")doAuth()}}/>
            {aErr&&<div style={{fontSize:12,color:"#dc2626",background:"#fee2e2",borderRadius:12,padding:"12px 16px",fontWeight:500}}>{aErr}</div>}
            <button onClick={doAuth} style={Object.assign({},btn,{marginTop:8})}>{aMode==="login"?"Se connecter":"Cr√©er mon compte"}</button>
          </div>
        </div>
      </div>
    </div>
  );

  return(
    <div style={{minHeight:"100vh",background:TN.bg,fontFamily:F2,color:TN.tx}}>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
      <div style={{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"16px 20px",position:"sticky",top:0,zIndex:50,boxShadow:TN.shadowMd}}>
        <div style={{maxWidth:640,margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
          <div onClick={function(){setVw("home")}} style={{display:"flex",alignItems:"center",gap:10,cursor:"pointer",transition:"transform 0.2s ease"}}><Logo size={36}/><span style={{fontSize:20,fontWeight:700,fontFamily:F,color:"#fff",letterSpacing:"-0.5px"}}>TUN Trip</span></div>
          <div style={{display:"flex",alignItems:"center",gap:10}}><span style={{fontSize:13,color:"#fff",fontWeight:500}}>{user.nm}</span><button onClick={function(){setUser(null)}} style={{fontSize:11,padding:"8px 16px",borderRadius:10,border:"2px solid rgba(255,255,255,0.3)",background:"rgba(255,255,255,0.15)",cursor:"pointer",color:"#fff",fontWeight:600,backdropFilter:"blur(10px)",transition:"all 0.3s ease"}}>D√©connexion</button></div>
        </div>
      </div>

      <div style={{position:"fixed",bottom:0,left:0,right:0,background:"rgba(255,255,255,0.98)",borderTop:"1px solid "+TN.bd,display:"flex",justifyContent:"center",gap:60,padding:"12px 0 16px",zIndex:50,boxShadow:"0 -4px 16px rgba(0,0,0,0.08)",backdropFilter:"blur(10px)"}}>
        {[{v:"home",i:"‚ú®",l:"Nouveau"},{v:"trips",i:"üìã",l:"Mes Voyages"}].map(function(t){return <button key={t.v} onClick={function(){setVw(t.v)}} style={{background:"none",border:"none",cursor:"pointer",textAlign:"center",color:vw===t.v?TN.pr:TN.tL,transition:"all 0.3s ease",transform:vw===t.v?"scale(1.05)":"scale(1)"}}><div style={{fontSize:24,marginBottom:4}}>{t.i}</div><div style={{fontSize:10,fontWeight:600,letterSpacing:"0.5px"}}>{t.l}</div></button>})}
      </div>

      <div style={{maxWidth:640,margin:"0 auto",padding:"16px 16px 80px"}}>

        {vw==="home"&&<div>
          <Carousel/>
          <div style={{textAlign:"center",marginBottom:20}}>
            <p style={{fontSize:14,color:TN.pr,fontWeight:600,fontFamily:F,letterSpacing:.8,margin:"0 0 16px"}}>D√©couvrez les perles de la Tunisie</p>
            <div style={{background:TN.card,borderRadius:20,padding:"20px 24px",border:"1px solid "+TN.bd,textAlign:"left",marginBottom:20,boxShadow:TN.shadow}}>
              <p style={{fontSize:13,color:TN.tM,lineHeight:1.8,margin:0}}>La Tunisie, carrefour de civilisations entre Sahara et M√©diterran√©e. Des ruines romaines de Dougga aux plages turquoise de Djerba, des m√©dinas mill√©naires aux oasis du Sud ‚Äî chaque r√©gion raconte une histoire unique. Planifiez votre voyage et explorez 262 destinations √† travers 11 r√©gions.</p>
            </div>
            <h2 style={{fontSize:28,fontWeight:700,fontFamily:F,color:TN.tx,margin:"0 0 8px",letterSpacing:"-0.5px"}}>Bienvenue, {user.nm}</h2>
            <p style={{fontSize:14,color:TN.tM,fontFamily:F}}>Comment souhaitez-vous explorer ?</p>
          </div>

          <div onClick={function(){setVw("ai_prefs")}} style={{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:24,padding:28,cursor:"pointer",marginBottom:16,position:"relative",overflow:"hidden",boxShadow:TN.shadowLg,transition:"transform 0.3s ease,box-shadow 0.3s ease",border:"none"}}>
            <div style={{position:"absolute",inset:0,opacity:.1,backgroundImage:"repeating-linear-gradient(45deg,#fff 0,#fff 2px,transparent 2px,transparent 16px)"}}/>
            <div style={{position:"relative"}}><div style={{display:"flex",alignItems:"center",gap:14,marginBottom:10}}><div style={{width:52,height:52,borderRadius:16,background:"rgba(255,255,255,0.25)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,color:"#fff",backdropFilter:"blur(10px)"}}>AI</div><div><div style={{fontSize:22,fontWeight:700,fontFamily:F,color:"#fff",letterSpacing:"-0.3px"}}>L'IA planifie pour moi</div><div style={{fontSize:11,color:"rgba(255,255,255,0.9)",background:"rgba(255,255,255,0.2)",borderRadius:8,padding:"4px 12px",display:"inline-block",fontWeight:600,marginTop:4}}>‚ú® Recommand√©</div></div></div>
            <p style={{fontSize:14,color:"rgba(255,255,255,0.95)",lineHeight:1.7,margin:0}}>L'IA choisit les r√©gions et les meilleurs spots pour chaque jour selon vos pr√©f√©rences.</p></div>
          </div>
          <div onClick={function(){setVw("man_prefs")}} style={Object.assign({},cs,{cursor:"pointer",padding:28,borderWidth:2,transition:"all 0.3s ease",borderColor:TN.bd})}>
            <div style={{display:"flex",alignItems:"center",gap:14,marginBottom:10}}><div style={{width:52,height:52,borderRadius:16,background:"linear-gradient(135deg, "+TN.sand+" 0%, #ffe8cc 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:700,color:TN.pD,border:"2px solid "+TN.sD}}>M</div><div><div style={{fontSize:22,fontWeight:700,fontFamily:F,color:TN.tx,letterSpacing:"-0.3px"}}>Je choisis moi-m√™me</div><div style={{fontSize:12,color:TN.tM,marginTop:2}}>S√©lection manuelle par r√©gion</div></div></div>
            <p style={{fontSize:14,color:TN.tM,lineHeight:1.7,margin:0}}>Choisissez une r√©gion, filtrez par cat√©gorie, composez votre itin√©raire personnalis√©.</p>
          </div>
        </div>}

        {/* AI PREFS ‚Äî ONLY: preferences + companions + days */}
        {vw==="ai_prefs"&&<div>
          {back(function(){setVw("home")})}
          <div style={{textAlign:"center",marginBottom:24}}><div style={{fontSize:22,fontWeight:700,color:"#fff",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",width:56,height:56,borderRadius:16,display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto",boxShadow:TN.shadowMd}}>AI</div><h2 style={{fontSize:30,fontWeight:700,fontFamily:F,color:TN.tx,margin:"12px 0 6px",letterSpacing:"-0.5px"}}>Voyage intelligent</h2><p style={{fontSize:14,color:TN.tM,fontFamily:F}}>Dites-nous vos envies, on fait le reste</p></div>

          <div style={cs}><div style={ls}>üé≠ Qu'est-ce qui vous passionne ?</div>
            <div style={{display:"flex",gap:10,flexWrap:"wrap"}}>{Object.keys(PROFILES).map(function(k){var p=PROFILES[k];var s=profs.indexOf(k)>=0;return <button key={k} onClick={function(){togP(k)}} style={{padding:"14px 20px",borderRadius:32,cursor:"pointer",border:s?"2px solid "+TN.pr:"2px solid "+TN.bd,background:s?"linear-gradient(135deg,"+TN.pr+" 0%, "+TN.pD+" 100%)":"#fff",fontSize:14,fontWeight:600,color:s?"#fff":TN.tM,boxShadow:s?TN.shadowMd:"none",transition:"all 0.3s ease",transform:s?"scale(1.02)":"scale(1)"}}>{p.i} {p.l}</button>})}</div>
          </div>

          <div style={Object.assign({},cs,{marginTop:16})}><div style={ls}>üë• Avec qui voyagez-vous ?</div>
            <div style={{display:"flex",gap:10,flexWrap:"wrap"}}>{COMPS.map(function(c){return <button key={c.k} onClick={function(){setComp(c.k)}} style={{padding:"14px 20px",borderRadius:16,cursor:"pointer",border:comp===c.k?"2px solid "+TN.ac:"2px solid "+TN.bd,background:comp===c.k?"linear-gradient(135deg, "+TN.aL+" 0%, #e3f2fd 100%)":"#fff",fontSize:14,fontWeight:600,color:comp===c.k?TN.ac:TN.tM,transition:"all 0.3s ease",boxShadow:comp===c.k?TN.shadow:"none",transform:comp===c.k?"scale(1.02)":"scale(1)"}}>{c.i} {c.l}</button>})}</div>
          </div>

          <div style={Object.assign({},cs,{marginTop:14})}><div style={ls}>üó∫Ô∏è Zones & R√©gions <span style={{fontSize:8,fontWeight:400,color:TN.tL}}>(choix multiple)</span></div>
            {/* Toggle zone helper */}
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:6}}>
              {Object.keys(ZONES).filter(function(k){return ZONES[k].g==="top"}).map(function(k){var z=ZONES[k];var isSel=zones.indexOf(k)>=0;return <button key={k} onClick={function(){setZones(function(prev){if(k==="all")return["all"];var next=prev.filter(function(x){return x!=="all"&&ZONES[x]?.g==="top"});var idx=next.indexOf(k);if(idx>=0){next.splice(idx,1);return next.length?next:["all"]}next.push(k);return next})}} style={{padding:"10px 8px",borderRadius:12,cursor:"pointer",border:isSel?"2.5px solid "+TN.tile:"1.5px solid "+TN.bd,background:isSel?"linear-gradient(135deg,"+TN.aL+",#fff)":TN.card,textAlign:"center",transition:"all .15s"}}>
                <div style={{fontSize:18}}>{z.i}</div>
                <div style={{fontSize:11,fontWeight:700,color:isSel?TN.tile:TN.tM,marginTop:2}}>{z.l}</div>
                <div style={{fontSize:8,color:TN.tL}}>{z.regions.length} r√©gions</div>
              </button>})}
            </div>
            <div style={{fontSize:9,fontWeight:700,color:TN.tL,textTransform:"uppercase",letterSpacing:1,marginTop:10,marginBottom:6}}>Ou choisir des r√©gions</div>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:5}}>
              {Object.keys(ZONES).filter(function(k){return ZONES[k].g==="reg"}).map(function(k){var z=ZONES[k];var rc=PL.filter(function(p){return z.regions.indexOf(p.r)>=0}).length;var isSel=zones.indexOf(k)>=0;return <button key={k} onClick={function(){setZones(function(prev){var next=prev.filter(function(x){return x!=="all"&&ZONES[x]?.g!=="top"});var idx=next.indexOf(k);if(idx>=0){next.splice(idx,1);return next.length?next:["all"]}next.push(k);return next})}} style={{padding:"8px 4px",borderRadius:10,cursor:"pointer",border:isSel?"2px solid "+TN.pr:"1px solid "+TN.bd,background:isSel?"linear-gradient(135deg,"+TN.sand+",#fff)":TN.card,textAlign:"center",transition:"all .15s"}}>
                <div style={{fontSize:14}}>{z.i}</div>
                <div style={{fontSize:9,fontWeight:700,color:isSel?TN.pD:TN.tM,marginTop:1}}>{z.l}</div>
                <div style={{fontSize:7,color:TN.tL}}>{rc} lieux</div>
              </button>})}
            </div>
            <div style={{fontSize:9,color:TN.tM,marginTop:6}}>‚úÖ {zones.indexOf("all")>=0?"Toutes les r√©gions":zones.map(function(k){return ZONES[k]?.i||""}).join(" ")+" s√©lectionn√©e"+(zones.length>1?"s":"")}</div>
          </div>

          <div style={Object.assign({},cs,{marginTop:16})}><div style={ls}>üìÖ Combien de jours ?</div>
            <div style={{display:"flex",gap:10,flexWrap:"wrap"}}>{[1,2,3,5,7,10,14].map(function(d){return <button key={d} onClick={function(){setND(d)}} style={{width:56,height:56,borderRadius:16,cursor:"pointer",border:nD===d?"2px solid "+TN.pr:"2px solid "+TN.bd,background:nD===d?"linear-gradient(135deg,"+TN.pr+" 0%,"+TN.pD+" 100%)":"#fff",color:nD===d?"#fff":TN.tM,fontSize:22,fontWeight:700,fontFamily:F,transition:"all 0.3s ease",boxShadow:nD===d?TN.shadowMd:"none",transform:nD===d?"scale(1.05)":"scale(1)"}}>{d}</button>})}</div>
            <div style={{fontSize:12,color:TN.tM,marginTop:12,lineHeight:1.7,background:TN.sand+"60",padding:"12px 16px",borderRadius:12}}>{nD} jour{nD>1?"s":""} ‚Äî destinations proches (max 40km), max 5 spots/jour</div>
          </div>

          <div style={Object.assign({},cs,{marginTop:16})}><div style={ls}>üí∞ Budget maximum</div>
            <div style={{display:"flex",alignItems:"baseline",gap:8,marginTop:8}}>
              <span style={{fontSize:36,fontWeight:700,fontFamily:F,color:TN.pr,letterSpacing:"-1px"}}>{bud}</span>
              <span style={{fontSize:16,color:TN.tM,fontWeight:600}}>TND</span>
              <span style={{fontSize:14,color:TN.tL,marginLeft:"auto",background:TN.sand,padding:"6px 14px",borderRadius:10,border:"1px solid "+TN.sD}}>‚âà {Math.round(bud*0.29)} EUR</span>
            </div>
            <input type="range" min={50} max={6000} step={50} value={bud} onChange={function(e){setBud(Number(e.target.value))}} style={{width:"100%",marginTop:16,accentColor:TN.pr,height:8,borderRadius:8}}/>
            <div style={{display:"flex",justifyContent:"space-between",fontSize:11,color:TN.tM,marginTop:8,fontWeight:500}}><span>50 TND</span><span>6000 TND</span></div>
          </div>

          <div style={Object.assign({},cs,{marginTop:16})}><div style={ls}>üçΩÔ∏è Inclure les repas ?</div>
            <div style={{display:"flex",gap:10}}>
              {[{k:"bk",v:wBk,fn:setWBk,i:"üåÖ",l:"Petit-d√©j"},{k:"lu",v:wLu,fn:setWLu,i:"‚òÄÔ∏è",l:"D√©jeuner"},{k:"di",v:wDi,fn:setWDi,i:"üåô",l:"D√Æner"}].map(function(m){return <button key={m.k} onClick={function(){m.fn(!m.v)}} style={{flex:1,padding:"16px 10px",borderRadius:16,cursor:"pointer",border:m.v?"2px solid "+TN.gn:"2px solid "+TN.bd,background:m.v?"linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)":"#fff",textAlign:"center",transition:"all 0.3s ease",boxShadow:m.v?TN.shadow:"none",transform:m.v?"scale(1.02)":"scale(1)"}}>
                <div style={{fontSize:20,marginBottom:4}}>{m.i}</div>
                <div style={{fontSize:11,fontWeight:600,color:m.v?TN.gn:TN.tL}}>{m.l}</div>
              </button>})}
            </div>
          </div>

          {(wBk||wLu||wDi||profs.indexOf("hotelier")>=0)&&<div style={{background:"linear-gradient(135deg, #fff9e6 0%, #fff3cc 100%)",borderRadius:16,padding:18,border:"2px solid #ffe699",marginTop:16,boxShadow:TN.shadow}}>
            <div style={{fontSize:14,fontWeight:700,color:"#d97706",marginBottom:8}}>üìã Inclus dans votre plan</div>
            <div style={{display:"flex",gap:12,fontSize:12,color:TN.tM,flexWrap:"wrap",fontWeight:500}}>
              {wBk&&<span style={{background:"#fff",padding:"6px 12px",borderRadius:10,border:"1px solid #fbbf24"}}>üåÖ Petit-d√©j</span>}{wLu&&<span style={{background:"#fff",padding:"6px 12px",borderRadius:10,border:"1px solid #fbbf24"}}>‚òÄÔ∏è D√©jeuner</span>}{wDi&&<span style={{background:"#fff",padding:"6px 12px",borderRadius:10,border:"1px solid #fbbf24"}}>üåô D√Æner</span>}{profs.indexOf("hotelier")>=0&&<span style={{background:"#fff",padding:"6px 12px",borderRadius:10,border:"1px solid #fbbf24"}}>üè® H√¥tel 5‚òÖ</span>}
            </div>
          </div>}
          {!wBk&&!wLu&&!wDi&&profs.indexOf("hotelier")<0&&<div style={{background:"linear-gradient(135deg, "+TN.aL+" 0%, #e3f2fd 100%)",borderRadius:16,padding:18,border:"2px solid #90caf9",marginTop:16,boxShadow:TN.shadow}}>
            <div style={{fontSize:13,color:TN.ac,fontWeight:600}}>‚ÑπÔ∏è Plan destinations uniquement</div>
          </div>}

          <button onClick={aiGo} disabled={!profs.length} style={Object.assign({},btn,{marginTop:20,opacity:profs.length?1:.5,fontSize:17,padding:"18px 24px",cursor:profs.length?"pointer":"not-allowed"})}>{profs.length?"üöÄ Cr√©er mon voyage":"S√©lectionnez au moins un style"}</button>
        </div>}

        {vw==="ai_load"&&<div>{back(function(){setVw("ai_prefs")})}{LoadUI}</div>}

        {/* AI RESULT */}
        {vw==="ai_result"&&itin&&<div>
          {back(function(){setVw("ai_prefs")})}
          <div style={{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16}}>
            {profs.map(function(k){return <span key={k} style={{fontSize:11,fontWeight:600,background:"linear-gradient(135deg, "+TN.sand+" 0%, #ffe8cc 100%)",color:TN.pD,borderRadius:24,padding:"6px 14px",border:"1px solid "+TN.sD,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"}}>{PROFILES[k].i} {PROFILES[k].l}</span>})}
            <span style={{fontSize:11,fontWeight:600,background:"linear-gradient(135deg, "+TN.aL+" 0%, #e3f2fd 100%)",color:TN.ac,borderRadius:24,padding:"6px 14px",border:"1px solid #90caf9",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"}}>{COMPS.find(function(c){return c.k===comp})?.i} {COMPS.find(function(c){return c.k===comp})?.l}</span>
            <span style={{fontSize:11,fontWeight:600,background:"linear-gradient(135deg, #fff9c4 0%, #fff59d 100%)",color:"#d97706",borderRadius:24,padding:"6px 14px",border:"1px solid #fdd835",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"}}>{nD}j</span>
            <span style={{fontSize:11,fontWeight:600,background:"linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%)",color:TN.tile,borderRadius:24,padding:"6px 14px",border:"1px solid #64b5f6",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"}}>{zones.indexOf("all")>=0?"üáπüá≥ Toute la Tunisie":zones.map(function(k){return(ZONES[k]?.i||"")+" "+(ZONES[k]?.l||"")}).join(" ¬∑ ")}</span>
          </div>
          {(function(){var dr=REGIONS.find(function(r){return r.id===(itin.days[aD]?.rid)});return <LeafletMap lt={dr?.lt||34.5} lg={dr?.lg||9.5} z={dr?10:7} h={240} spots={itin.days[aD]?.spots||[]} activeRid={itin.days[aD]?.rid}/>})()}
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:16,marginBottom:12}}>
            <div><div style={{fontSize:26,fontWeight:700,fontFamily:F,color:TN.tx,letterSpacing:"-0.5px"}}>Votre voyage</div><div style={{fontSize:13,color:TN.tM,marginTop:4,fontWeight:500}}>{itin.stats.total} spots{itin.stats.meals?" ¬∑ "+itin.stats.meals+" repas":""}{itin.stats.hotels?" ¬∑ "+itin.stats.hotels+" h√¥tels":""} ¬∑ ~{itin.stats.cost} TND (‚âà{Math.round(itin.stats.cost*0.29)} EUR)</div></div>
            <button onClick={saveTrip} style={{padding:"12px 20px",borderRadius:12,border:"none",background:"linear-gradient(135deg, "+TN.gn+" 0%, #43a047 100%)",color:"#fff",fontSize:13,fontWeight:600,cursor:"pointer",boxShadow:TN.shadow,transition:"all 0.3s ease"}}>üíæ Sauver</button>
          </div>
          <div style={{display:"flex",gap:8,marginBottom:16,marginTop:12,overflowX:"auto",paddingBottom:4}}>{itin.days.map(function(day,i){var dr=REGIONS.find(function(r){return r.id===day.rid});return <button key={i} onClick={function(){setAD(i)}} style={{padding:"12px 18px",borderRadius:14,border:aD===i?"2px solid "+TN.pD:"2px solid "+TN.bd,background:aD===i?"linear-gradient(135deg, "+TN.pD+" 0%, "+TN.pr+" 100%)":"#fff",color:aD===i?"#fff":TN.tM,fontSize:13,fontWeight:600,cursor:"pointer",fontFamily:F,whiteSpace:"nowrap",boxShadow:aD===i?TN.shadowMd:"none",transition:"all 0.3s ease",transform:aD===i?"scale(1.02)":"scale(1)"}}>{dr?.icon} Jour {i+1}</button>})}</div>
          <DayView day={itin.days[aD]} di={aD}/>
          <div style={Object.assign({},cs,{marginTop:16})}>
            <div style={{fontSize:18,fontWeight:700,fontFamily:F,color:TN.tx,marginBottom:12,letterSpacing:"-0.3px"}}>üó∫Ô∏è Vue d'ensemble</div>
            {itin.days.map(function(day,di){var dr=REGIONS.find(function(r){return r.id===day.rid});return <div key={di} style={{padding:"12px 14px",background:di%2===0?"linear-gradient(135deg, "+TN.sand+"60 0%, #fff 100%)":"#fff",borderRadius:12,marginBottom:8,border:"1px solid "+(di%2===0?TN.sD:TN.bd)}}>
              <span style={{fontSize:14,fontWeight:700,fontFamily:F,color:TN.pD}}>Jour {di+1} {dr?.icon} {dr?.name}: </span>
              <span style={{fontSize:12,color:TN.tM,lineHeight:1.6}}>{day.spots.map(function(s){return(s._ml?"üçΩ ":"")+ s.n}).join(" ‚Üí ")}</span>
            </div>})}
          </div>
          <button onClick={function(){setVw("home")}} style={{width:"100%",padding:"16px 24px",borderRadius:14,border:"2px solid "+TN.bd,fontSize:14,fontWeight:600,cursor:"pointer",color:TN.tM,background:"#fff",marginTop:16,fontFamily:F,transition:"all 0.3s ease"}}>‚Üê Nouveau voyage</button>
        </div>}

        {/* MANUAL PREFS */}
        {vw==="man_prefs"&&<div>
          {back(function(){setVw("home")})}
          <div style={{textAlign:"center",marginBottom:14}}><h2 style={{fontSize:24,fontWeight:700,fontFamily:F,color:TN.pD,margin:"4px 0"}}>Selection manuelle</h2><p style={{fontSize:12,color:TN.tL,fontStyle:"italic",fontFamily:F}}>Personnalisez chaque detail</p></div>

          <div style={cs}><div style={ls}>üóìÔ∏è Saison de voyage</div>
            <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:6}}>{Object.keys(SEASONS).map(function(k){var s=SEASONS[k];return <button key={k} onClick={function(){setSea(k)}} style={{padding:"10px 6px",borderRadius:12,cursor:"pointer",textAlign:"center",border:sea===k?"2px solid "+TN.pr:"1px solid "+TN.bd,background:sea===k?TN.sand:TN.card}}><div style={{fontSize:18}}>{s.i}</div><div style={{fontSize:11,fontWeight:700,color:sea===k?TN.pD:TN.tM,marginTop:2}}>{s.l}</div><div style={{fontSize:8,color:TN.tL}}>{s.s}</div></button>})}</div>
          </div>

          <div style={Object.assign({},cs,{marginTop:12})}><div style={ls}>Destinations <span style={{fontSize:8,fontWeight:400,color:TN.tL}}>({rc(regs)} lieux, choix multiple)</span></div><div style={{display:"flex",gap:5,flexWrap:"wrap"}}>{REGIONS.map(function(r){var isSel=regs.indexOf(r.id)>=0;return <button key={r.id} onClick={function(){setRegs(function(prev){var idx=prev.indexOf(r.id);if(idx>=0){var next=prev.filter(function(x){return x!==r.id});return next.length?next:[r.id]}return prev.concat([r.id])})}} style={{padding:"7px 11px",borderRadius:10,cursor:"pointer",border:isSel?"2px solid "+TN.pr:"1px solid "+TN.bd,background:isSel?TN.sand:TN.card,fontSize:10,fontWeight:600,color:isSel?TN.pD:TN.tM}}>{r.icon} {r.name}</button>})}</div>
          {rObj&&<div style={{marginTop:8}}><LeafletMap lt={rObj.lt} lg={rObj.lg} z={regs.length>2?7:rObj.id==="sud_est"||rObj.id==="sud_ouest"?8:10} h={200} spots={PL.filter(function(p){return regs.indexOf(p.r)>=0}).slice(0,15)} activeRid={regs[0]}/></div>}
          {<div style={{display:"flex",gap:4,marginTop:8,flexWrap:"wrap"}}>{regs.map(function(rid){var rr=REGIONS.find(function(x){return x.id===rid});return rr?rr.subs.map(function(s){return <span key={s} style={{fontSize:9,background:TN.sand,borderRadius:6,padding:"3px 8px",color:TN.pD,fontWeight:600}}>{s}</span>}):null})}</div>}
          </div>

          <div style={Object.assign({},cs,{marginTop:12})}><div style={ls}>üë• Compagnons</div>
            <div style={{display:"flex",gap:6,flexWrap:"wrap"}}>{COMPS.map(function(c){return <button key={c.k} onClick={function(){setComp(c.k)}} style={{padding:"8px 14px",borderRadius:10,cursor:"pointer",border:comp===c.k?"2px solid "+TN.ac:"1px solid "+TN.bd,background:comp===c.k?TN.aL:TN.card,fontSize:11,fontWeight:600,color:comp===c.k?TN.ac:TN.tM}}>{c.i} {c.l}</button>})}</div>
          </div>

          <div style={Object.assign({},cs,{marginTop:12})}><div style={ls}>üé≠ Style de voyage <span style={{color:TN.pr}}>(multi-s√©lection)</span></div>
            <div style={{display:"flex",gap:5,flexWrap:"wrap"}}>{Object.keys(PROFILES).map(function(k){var p=PROFILES[k];var s=profs.indexOf(k)>=0;return <button key={k} onClick={function(){togP(k)}} style={{padding:"7px 13px",borderRadius:24,cursor:"pointer",border:s?"2px solid "+TN.pr:"1px solid "+TN.bd,background:s?TN.sand:TN.card,fontSize:11,fontWeight:600,color:s?TN.pD:TN.tM}}>{p.i} {p.l}</button>})}</div>
          </div>

          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:12}}>
            <div style={cs}>
              <div style={{fontSize:9,fontWeight:700,color:TN.tL,textTransform:"uppercase"}}>üïê Heure de d√©part</div>
              <div style={{display:"flex",alignItems:"baseline",gap:2,marginTop:4}}><span style={{fontSize:28,fontWeight:700,fontFamily:F,color:TN.pD}}>{sH}</span><span style={{fontSize:14,color:TN.tL}}>h00</span></div>
              <input type="range" min={6} max={14} value={sH} onChange={function(e){setSH(Number(e.target.value))}} style={{width:"100%",accentColor:TN.pr}}/>
            </div>
            <div style={cs}>
              <div style={{fontSize:9,fontWeight:700,color:TN.tL,textTransform:"uppercase"}}>üìÖ Nombre de jours</div>
              <div style={{display:"flex",alignItems:"baseline",gap:2,marginTop:4}}><span style={{fontSize:28,fontWeight:700,fontFamily:F,color:TN.pD}}>{nD}</span><span style={{fontSize:14,color:TN.tL}}> jour{nD>1?"s":""}</span></div>
              <input type="range" min={1} max={14} value={nD} onChange={function(e){setND(Number(e.target.value))}} style={{width:"100%",accentColor:TN.pr}}/>
            </div>
          </div>

          <div style={Object.assign({},cs,{marginTop:12})}>
            <div style={{fontSize:9,fontWeight:700,color:TN.tL,textTransform:"uppercase"}}>üí∞ Budget max</div>
            <div style={{display:"flex",alignItems:"baseline",gap:4,marginTop:4}}><span style={{fontSize:28,fontWeight:700,fontFamily:F,color:TN.pD}}>{bud}</span><span style={{fontSize:14,color:TN.tL}}>TND</span><span style={{fontSize:12,color:TN.tM,marginLeft:6}}>‚âà {Math.round(bud*0.29)} EUR</span></div>
            <input type="range" min={50} max={6000} step={50} value={bud} onChange={function(e){setBud(Number(e.target.value))}} style={{width:"100%",accentColor:TN.pr}}/>
            <div style={{display:"flex",justifyContent:"space-between",fontSize:9,color:TN.tL}}><span>50 TND</span><span>6000 TND</span></div>
          </div>

          <div style={Object.assign({},cs,{marginTop:12})}><div style={{fontSize:9,fontWeight:700,color:TN.tL,textTransform:"uppercase"}}>üçΩÔ∏è Inclure les repas</div>
            <div style={{display:"flex",gap:6,marginTop:6}}>
              {[{k:"bk",v:wBk,fn:setWBk,i:"üåÖ",l:"Petit-d√©j"},{k:"lu",v:wLu,fn:setWLu,i:"‚òÄÔ∏è",l:"D√©jeuner"},{k:"di",v:wDi,fn:setWDi,i:"üåô",l:"D√Æner"}].map(function(m){return <button key={m.k} onClick={function(){m.fn(!m.v)}} style={{flex:1,padding:"8px 4px",borderRadius:10,cursor:"pointer",border:m.v?"2px solid "+TN.gn:"1.5px solid "+TN.bd,background:m.v?"#eafaf1":TN.card,textAlign:"center",fontSize:10,fontWeight:700,color:m.v?TN.gn:TN.tL}}>
                {m.i} {m.l} {m.v?"‚úì":""}
              </button>})}
            </div>
          </div>

          <div style={{display:"flex",gap:6,marginTop:12}}>
            <button onClick={function(){setAvC(!avC)}} style={{flex:1,padding:"10px 12px",borderRadius:12,cursor:"pointer",border:avC?"2px solid "+TN.pr:"1px solid "+TN.bd,background:avC?TN.sand:TN.card,fontSize:11,fontWeight:600,color:avC?TN.pD:TN.tM,display:"flex",alignItems:"center",gap:6}}>Eviter la foule {avC?"‚úì":""}</button>
            <button onClick={function(){setIH(!iH)}} style={{flex:1,padding:"10px 12px",borderRadius:12,cursor:"pointer",border:iH?"2px solid "+TN.pr:"1px solid "+TN.bd,background:iH?TN.sand:TN.card,fontSize:11,fontWeight:600,color:iH?TN.pD:TN.tM,display:"flex",alignItems:"center",gap:6}}>Pepites cachees {iH?"‚úì":""}</button>
          </div>

          <button onClick={manGo} disabled={!profs.length} style={Object.assign({},btn,{marginTop:14,opacity:profs.length?1:.5})}>Voir les {rc(regs)} spots</button>
        </div>}

        {vw==="man_sel"&&<div>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:10}}>
            <div><div style={{fontSize:20,fontWeight:700,fontFamily:F,color:TN.pD}}>Choisissez vos spots</div><div style={{fontSize:11,color:TN.tL}}>{sel.size} selectionne(s) ¬∑ {regs.map(function(r){return REGIONS.find(function(x){return x.id===r})?.name||""}).join(", ")}</div></div>
            {back(function(){setVw("man_prefs")})}
          </div>
          <div style={{display:"flex",gap:5,marginBottom:10,overflowX:"auto",paddingBottom:4}}>
            <button onClick={function(){setCatF("all")}} style={{padding:"6px 14px",borderRadius:20,border:catF==="all"?"2px solid "+TN.pD:"1px solid "+TN.bd,background:catF==="all"?TN.pD:TN.card,color:catF==="all"?"#fff":TN.tM,fontSize:11,fontWeight:600,cursor:"pointer",whiteSpace:"nowrap"}}>All</button>
            {cats.map(function(c){return <button key={c} onClick={function(){setCatF(c)}} style={{padding:"6px 14px",borderRadius:20,border:catF===c?"2px solid "+TN.pD:"1px solid "+TN.bd,background:catF===c?TN.pD:TN.card,color:catF===c?"#fff":TN.tM,fontSize:11,fontWeight:600,cursor:"pointer",whiteSpace:"nowrap"}}>{CATS[c].i} {CATS[c].l}</button>})}
          </div>
          {rObj&&rObj.subs.map(function(sub){
            var sites=scored.filter(function(s){return s.sub===sub&&(catF==="all"||s.cat===catF)});if(!sites.length)return null;
            return <div key={sub} style={{marginBottom:14}}>
              <div style={{fontSize:13,fontWeight:700,fontFamily:F,color:TN.pD,marginBottom:6}}>üìå {sub}</div>
              {sites.map(function(site){var sl=sel.has(site.id);var inS=site.sn&&site.sn.indexOf(sea)>=0;
                return <div key={site.id} onClick={function(){togS(site.id)}} style={{display:"flex",gap:10,alignItems:"center",padding:"10px 12px",borderRadius:14,cursor:"pointer",background:sl?TN.sand:TN.card,border:sl?"2px solid "+TN.pr:"1px solid "+TN.bd,marginBottom:6,opacity:inS?1:.45}}>
                  <div style={{width:36,height:36,borderRadius:10,background:sl?TN.pr+"15":TN.sand,display:"flex",alignItems:"center",justifyContent:"center",fontSize:17}}>{CATS[site.cat].i}</div>
                  <div style={{flex:1}}><div style={{fontSize:13,fontWeight:700,fontFamily:F,color:TN.tx}}>{site.hid?"‚ú® ":""}{site.n}{!inS?" ‚ö†Ô∏è":""}</div><div style={{fontSize:9,color:TN.tL}}>{CATS[site.cat].l} ¬∑ ‚≠ê{site.rt} ¬∑ Score {site.sc}{site.meal?" ¬∑ "+ML[site.meal]:""}</div></div>
                  <div style={{width:22,height:22,borderRadius:"50%",border:"2px solid "+(sl?TN.pr:TN.bd),background:sl?TN.pr:"transparent",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:800}}>{sl?"‚úì":""}</div>
                </div>})}
            </div>})}
          {sel.size>0&&<div style={{background:"#e8f4f8",borderRadius:10,padding:"8px 12px",marginBottom:8,border:"1px solid #b8d8e8"}}>
            <div style={{fontSize:10,color:TN.ac,fontWeight:600}}>üõ£Ô∏è Optimisation g√©ographique activ√©e</div>
            <div style={{fontSize:9,color:TN.tM,marginTop:2}}>Les spots seront regroup√©s par proximit√© (max ~40km / ~30min) et ordonn√©s pour √©viter les allers-retours.</div>
          </div>}
          <button onClick={manBuild} disabled={!sel.size} style={Object.assign({},btn,{position:"sticky",bottom:64,opacity:sel.size?1:.5})}>Creer ({sel.size} spots ¬∑ {nD}j)</button>
        </div>}

        {vw==="man_load"&&LoadUI}

        {vw==="man_result"&&itin&&<div>
          {back(function(){setVw("man_sel")})}
          {rObj&&<LeafletMap lt={rObj.lt} lg={rObj.lg} z={regs.length>2?8:10} h={200} spots={itin.days[aD]?.spots||[]} activeRid={regs[0]}/>}
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:12,marginBottom:4}}>
            <div><div style={{fontSize:22,fontWeight:700,fontFamily:F,color:TN.pD}}>{rObj?.name}</div><div style={{fontSize:12,color:TN.tL}}>{itin.stats.days}j ¬∑ {itin.stats.total} spots ¬∑ {itin.stats.cost} TND (‚âà{Math.round(itin.stats.cost*0.29)} EUR)</div></div>
            <button onClick={saveTrip} style={{padding:"8px 16px",borderRadius:10,border:"none",background:TN.pr,color:"#fff",fontSize:12,fontWeight:700,cursor:"pointer"}}>üíæ Sauver</button>
          </div>
          <div style={{display:"flex",gap:5,marginBottom:10,marginTop:6}}>{itin.days.map(function(_,i){return <button key={i} onClick={function(){setAD(i)}} style={{padding:"8px 16px",borderRadius:10,border:aD===i?"2px solid "+TN.pD:"1px solid "+TN.bd,background:aD===i?TN.pD:TN.card,color:aD===i?"#fff":TN.tM,fontSize:13,fontWeight:700,cursor:"pointer",fontFamily:F}}>Jour {i+1}</button>})}</div>
          <DayView day={itin.days[aD]} di={aD}/>
          <button onClick={function(){setVw("home")}} style={{width:"100%",padding:12,borderRadius:14,border:"2px solid "+TN.bd,fontSize:13,fontWeight:700,cursor:"pointer",color:TN.tM,background:TN.card,marginTop:10,fontFamily:F}}>‚Üê Nouveau voyage</button>
        </div>}

        {vw==="trips"&&<div>
          <h2 style={{fontSize:24,fontWeight:700,fontFamily:F,color:TN.pD,margin:"8px 0 16px"}}>Mes Voyages</h2>
          {!trips.length&&<div style={{textAlign:"center",padding:40,color:TN.tL}}>üß≥ Aucun voyage</div>}
          {trips.map(function(t){return <div key={t.id} onClick={function(){setAT(t);setVw("trip")}} style={Object.assign({},cs,{marginBottom:10,cursor:"pointer",display:"flex",gap:14,alignItems:"center"})}>
            <div style={{fontSize:28}}>üß≥</div><div><div style={{fontSize:15,fontWeight:700,fontFamily:F,color:TN.pD}}>{t.nm}</div><div style={{fontSize:11,color:TN.tL}}>{t.dy}j ¬∑ {t.sp} spots ¬∑ {t.dt}</div></div>
          </div>})}
        </div>}

        {vw==="trip"&&aT&&<div>
          {back(function(){setVw("trips")})}
          <h2 style={{fontSize:22,fontWeight:700,fontFamily:F,color:TN.pD,marginBottom:10}}>{aT.nm}</h2>
          {aT.it.days.map(function(day,di){var dr=REGIONS.find(function(r){return r.id===day.rid});return <div key={di} style={Object.assign({},cs,{marginBottom:8})}><div style={{fontSize:15,fontWeight:700,fontFamily:F,color:TN.pD}}>{dr?.icon} Jour {di+1} ‚Äî {dr?.name}</div><div style={{fontSize:11,color:TN.tM,marginTop:4}}>{day.spots.map(function(s){return s.n}).join(" ‚Üí ")}</div></div>})}
        </div>}

        <div style={{textAlign:"center",marginTop:20}}><div style={{height:2,background:"repeating-linear-gradient(90deg,"+TN.pr+" 0,"+TN.pr+" 5px,transparent 5px,transparent 8px)",marginBottom:6,opacity:.3}}/><div style={{fontSize:9,color:TN.tL}}>TUN Trip ¬∑ {PL.length} lieux ¬∑ {REGIONS.length} r√©gions ¬∑ AINC 2026</div></div>
      </div>
    </div>
  );
}
